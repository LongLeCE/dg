var AngularExtensions;(function(n){function t(n){var t=function(){for(var i=[],t=0;t<arguments.length;t++)i[t]=arguments[t];return new(n.bind.apply(n,[n].concat(i)))};return t.$inject=n.$inject,t}function i(n){var t=function(){for(var r,i=[],t=0;t<arguments.length;t++)i[t]=arguments[t];return r=new(n.bind.apply(n,[n].concat(i))),r.filter};return t.$inject=n.$inject,t}n.createDirectiveFactory=t;n.createFilterFactory=i})(AngularExtensions||(AngularExtensions={}));
var app=angular.module("dcApp",["ngRoute","ngAnimate","ngSanitize","ngProgress","pageslide-directive","ui.bootstrap"]).filter("to_trusted",["$sce",function(n){return function(t){return n.trustAsHtml(t)}}]).config(["$httpProvider",function(n){n.interceptors.push("httpRequestInterceptor");n.interceptors.push("ajaxStatusInterceptor")}]).directive("disallowSpaces",function(){return{restrict:"A",link:function(n,t){t.bind("input",function(){$(this).val($(this).val().replace(/ /g,""))})}}});app.factory("httpRequestInterceptor",["$rootScope",function(){return{request:function(n){return n.timeout=18e4,n.headers.ConnectionId=$.connection.hub.id,n}}}]);
var Shared;(function(n){var t=function(){function t(t,i){var r=this;this.$scope=t;this.progressBarService=i;this.finishRequest=function(){r.progressBarService.set(100);r.isLoading=!1};this.startRequest=function(){r.progressBarService.start();r.isLoading=!0};this.refreshUserInfo=function(t){r.$scope.$root.$broadcast(n.EventName.refreshUserInfo,t)};this.getSlide(t);t.$watch(function(){return r.mainSlide.isOpen},function(n,t){n!==t&&n?r.onSlideOpen():r.onSlideClose()})}return t.prototype.onSlideOpen=function(){},t.prototype.onSlideClose=function(){},t.prototype.getSlide=function(n){for(var t=n.$parent,i;t;)i=t.vm&&t.vm.slide||t.slide,i&&(this.mainSlide=i),t=t.$parent;return null},t}();n.PageBaseController=t})(Shared||(Shared={}));
var App;(function(n){var t;(function(){var n=function(){function n(n,t,i){var r=this;this.$scope=n;this.$http=t;this.progressBarService=i;this.isLoading=!1;this.$onInit=function(){r.model={start:!1,timeLeft:{hours:0,minutes:0,seconds:0}};r.getBanks()};this.getBanks=function(){r.$http.get("/BaoKim/GetBanks").then(function(n){r.model.banks=n.data})}}return n.$inject=["$scope","$http","progressBarService"],n}();app.controller("baoKimCtrl",n)})(t=n.BuyEgg||(n.BuyEgg={}))})(App||(App={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(n){var t;(function(n){var i=Shared.PageBaseController,t=function(n){function t(t,i,r,u){var f=n.call(this,t,u)||this;return f.$scope=t,f.$http=i,f.userStoreService=r,f.progressBarService=u,f.isLoading=!1,f.enableBuyEggForStandard=!1,f.$onInit=function(){f.model={start:!1,timeLeft:{hours:0,minutes:0,seconds:0}};f.getTimeLeft();f.model.facebookId=$.cookie("txtFbid");f.model.sessionId=$.cookie("txtUserKey")},f.init=function(n){n===void 0&&(n=!1);f.enableBuyEggForStandard=n;n||f.model.facebookId&&f.checkAccount()},f.getTimeLeft=function(){f.$http.post("/Buy/TimeLeft",null).then(function(n){var t=n.data;f.model.totalSeconds=t.totalSeconds;f.model.costs=t.costs;f.model.costsVip=t.costsVip;f.model.start=!0;f.model.top=t.top})},f.buyEggClick=function(n){f.model.result=null;f.model.isPremium=n;f.model.price=n?f.model.costsVip:f.model.costs;f.startRequest();f.$http.post("/Buy/Buy",f.model).then(function(n){var t=n.data;f.model.result=t}).finally(f.finishRequest)},f.onTicks=function(n){var t=n.split(":");f.model.timeLeft.hours=t[0];f.model.timeLeft.minutes=t[1];f.model.timeLeft.seconds=t[2]},f.checkAccount=function(){f.enableBuyEggForStandard||f.$http.post("/Buy/CheckAccount",{facebookId:f.model.facebookId}).then(function(n){f.model.user=n.data})},document.title="Buy any Eggs with some gems in Dragon City",f}return __extends(t,n),t.$inject=["$scope","$http","userStoreService","progressBarService"],t}(i);n.BuyEggController=t;app.controller("buyEggCtrl",t)})(t=n.BuyEgg||(n.BuyEgg={}))})(App||(App={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(n){var t;(function(){var n=Shared.PageBaseController,t=function(n){function t(t,i,r){var u=n.call(this,t,r)||this;return u.$scope=t,u.$http=i,u.progressBarService=r,u.isLoading=!1,u.$onInit=function(){},u.getTimeLeft=function(){u.$http.post("/Buy/TimeLeft",null).then(function(n){var t=n.data;u.model.totalSeconds=t.totalSeconds;u.model.costs=t.costs;u.model.costsVip=t.costsVip;u.model.start=!0})},u.buyEggClick=function(n){u.startRequest();u.model.isPremium=n;var t={itemId:u.model.selectedItem.Id,groupType:u.model.selectedItem.GroupType,price:u.model.costsVip};u.$http.post("/Buy/BuySomeItem",t).then(function(n){var t=n.data;u.model.result=t;t.success&&(window.refreshItemOnMap(),u.refreshUserInfo(n))}).finally(u.finishRequest)},u.onTicks=function(n){var t=n.split(":");u.model.timeLeft.hours=t[0];u.model.timeLeft.minutes=t[1];u.model.timeLeft.seconds=t[2]},u.getAllItems=function(){u.$http.post("/Buy/GetAllItems",null).then(function(n){u.itemsInStore=n.data})},u.model={start:!1,timeLeft:{hours:0,minutes:0,seconds:0}},u.getTimeLeft(),u.getAllItems(),u}return __extends(t,n),t.prototype.onSlideOpen=function(){this.model.selectedItem=null;this.model.result=null},t.$inject=["$scope","$http","progressBarService"],t}(n);app.controller("buyItemCtrl",t)})(t=n.BuyEgg||(n.BuyEgg={}))})(App||(App={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(n){var t;(function(){var n=Shared.PageBaseController,t=function(n){function t(t,i,r){var u=n.call(this,t,r)||this;return u.$scope=t,u.$http=i,u.progressBarService=r,u.isLoading=!1,u.$onInit=function(){u.model={chests:[],gatchas:[]}},u.getAllItems=function(){u.$http.get("/TestParam/GetChests",null).then(function(n){u.model.chests=n.data});u.$http.get("/TestParam/GetGatchas",null).then(function(n){u.model.gatchas=_.union(n.data.random_rewards,n.data.static_rewards)})},u.filterGatcha=function(n){var i=function(n,t){var i=new RegExp(t,"i");return n.gatcha_id.toString().search(i)==0||n.id.toString().search(i)==0},t;return u.searchGatcha?(t=!0,u.searchGatcha.split(" ").forEach(function(r){t=t&&i(n,r)}),t):!0},u.getAllItems(),u}return __extends(t,n),t.$inject=["$scope","$http","progressBarService"],t}(n);app.controller("chestCtrl",t)})(t=n.BuyEgg||(n.BuyEgg={}))})(App||(App={}));
var App;(function(n){var t;(function(){var n=function(){function n(n,t,i,r,u){var f=this,e;for(this.$scope=n,this.$routeParams=t,this.deityWorldService=i,this.progressBarService=r,this.userInfoContext=u,this.definedCrystalNeed={},this.$onInit=function(){},this.collectPlatinumClick=function(){f.deityWorldService.collectPlatinumHabitat().then(function(){})},this.addDisabledClassForCrystal=function(n){var i,t;if(n&&n!=="0")for(i=parseInt(n)%5,t=0;t<5;t++)f.definedCrystalNeed[t]=i===0?!0:t<i;else _.each(f.definedCrystalNeed,function(){return!1})},this.getImage=function(n){if(n){var t=n.replace(" ","_");return"/Content/Images/DeityWorld/"+t+".png"}return null},this.isEnlabledAllCrystall=function(){return!_.any(f.definedCrystalNeed,function(n){return n===!1})},this.craftClick=function(){f.isLoading=!0;f.progressBarService.start();var n=f.crystal.totalInput;f.deityWorldService.craft(f.nextCrystal.id,n).then(function(n){if(n.success){var t=n.result;f.crystal.total-=t.previousTotal;f.nextCrystal.total+=t.total;f.userInfoContext.user.platinum=f.currentPlatinum=f.currentPlatinum-f.totalPlatinum}}).finally(function(){f.progressBarService.set(100);f.isLoading=!1})},this.isLoading=!0,e=0;e<5;e++)this.definedCrystalNeed[e]=!1;this.deityWorldService.getCrystals().then(function(n){var t=parseInt(f.$routeParams.crystalId),i=parseInt(f.$routeParams.crystalTypeId);f.crystals=_.filter(n,function(n){return n.crystalType.id===i})[0].crystals;f.nextCrystal=_.filter(f.crystals,function(n){return n.id===t})[0];f.crystal=_.filter(f.crystals,function(n){return n.purity===f.nextCrystal.purity-1})[0];f.isLoading=!1;f.currentPlatinum=f.userInfoContext.user.platinum;f.crystal.totalInput=f.crystal.total}).then(function(){setTimeout(function(){f.$scope.$watch("vm.crystal.totalInput",function(n,t){f.crystal&&(f.totalPlatinum=n!==t?f.crystal.totalInput/5*f.nextCrystal.craft_Resources.p:f.crystal.total/5*f.nextCrystal.craft_Resources.p,f.crystal.totalInput?f.addDisabledClassForCrystal(n):f.addDisabledClassForCrystal(f.crystal.total.toString()))});f.$scope.$apply()},1e3)})}return n.$inject=["$scope","$routeParams","deityWorldService","progressBarService","userInfoContext"],n}();app.controller("crystalCraftDetailCtrl",n)})(t=n.DeityWorld||(n.DeityWorld={}))})(App||(App={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(n){var t;(function(){var n=Shared.PageBaseController,t=function(n){function t(t,i,r,u,f,e){var o=n.call(this,t,e)||this;o.$scope=t;o.$location=i;o.$timeout=r;o.userInfoContext=u;o.deityWorldService=f;o.progressBarService=e;o.$onInit=function(){};o.loadCrystal=function(){o.deityWorldService.getCrystals().then(function(n){o.model=n;_.each(n,function(n){_.each(n.crystals,function(t,i){i>0&&(t.totalInput=n.crystals[i-1]&&n.crystals[i-1].total||0)})});o.selectedTab=n[0]}).finally(function(){return o.progressBarService.set(100)})};o.setSelectedTab=function(n){o.selectedTab=n};o.getImage=function(n){var t=n.replace(" ","_");return"/Content/Images/DeityWorld/"+t+".png"};o.craftClick=function(n,t){o.startRequest();var i=n.totalInput||t>0&&o.selectedTab.crystals[t-1].total||0;o.deityWorldService.craft(n.id,i).then(function(i){if(i.success){var u=i.result,r=_.filter(o.selectedTab.crystals,function(n){return n.id===u.previousId})[0];return r&&(r.total-=i.result.previousTotal),o.currentPlatinum=i.p,n.total+=i.result.total,o.selectedTab.crystals[t+1].totalInput=n.total,n.total}}).finally(o.finishRequest)};o.getName=function(n){return n.split(" ")[0]};o.collectRawCrystal=function(n){o.selectedCrystal=n;o.startRequest();o.deityWorldService.craft(n.id,0).then(function(t){if(t.success){var r=t.result,i=_.filter(o.selectedTab.crystals,function(n){return n.id===r.previousId})[0];return i&&(i.total-=t.result.previousTotal),n.total+=t.result.total}}).finally(o.finishRequest)};o.isNumber=function(n){return!isNaN(n)};o.model=[];o.isUserLoaded=!0;$(document).on(Shared.TabName.acientWorld,function(){o.progressBarService.start();o.currentPlatinum=o.userInfoContext.user.platinum;o.isUserLoaded=!0;o.loadCrystal();o.deityWorldService.crystals=null});return o}return __extends(t,n),t.$inject=["$scope","$location","$timeout","userInfoContext","deityWorldService","progressBarService"],t}(n);app.controller("deityWorldCtrl",t)})(t=n.DeityWorld||(n.DeityWorld={}))})(App||(App={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(){var n=function(n){function t(t,i,r,u,f){var e=n.call(this,t,i)||this;e.$scope=t;e.progressBarService=i;e.dragonFactoryService=r;e.gridIslandService=u;e.messageService=f;e.$onInit=function(){};e.getGridIsland=function(){e.startRequest();e.gridIslandService.getEvent().then(function(n){e.model=n}).finally(e.finishRequest)};e.collectItem=function(n){e.startRequest();e.gridIslandService.collectItem(n).then(function(t){t.success&&(e.model.userData.currencyAmount=e.model.userData.currencyAmount-n.claim_cost,e.model.cost=n.claim_cost,e.model.userData.currentSquare=n.id,e.refreshUserInfo(t))}).finally(e.finishRequest)};$(document).on(Shared.EventName.userInfoLoaded,function(){e.model=null});$(document).on(Shared.TabName.gridIsland,function(){e.model||e.getGridIsland()});return e}return __extends(t,n),t.$inject=["$scope","progressBarService","dragonFactoryService","gridIslandService","messageService"],t}(Shared.PageBaseController);app.controller("gridIslandCtrl",n)})(App||(App={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n){this.$http=n}return n}();t.$inject=["$http"];n.HomeService=t;app.service("homeService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Shared;(function(n){var t=function(n){function t(t){var i=n.call(this,t,null)||this;return i.pagingItem=function(n){if(n&&n.length){i.paging.totalItems=n.length;var t=(i.paging.currentPage-1)*i.paging.itemsPerPage,r=t+i.paging.itemsPerPage;return n.slice(t,r)}return null},i.paging={itemsPerPage:50,currentPage:1,totalItems:0},i}return __extends(t,n),t}(n.PageBaseController);n.ListPageBaseController=t})(Shared||(Shared={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Shared;(function(n){var t=function(n){function t(t,i){var r=n.call(this,t)||this;return r.$scope=t,r.$timeout=i,r.filterDragon=function(){var n=r.filterModel;r.$timeout.cancel(r.throttleFilter);r.throttleFilter=r.$timeout(function(){var t=n.dragonName,i=_.filter(r.orgDragons,function(i){return(!n.rarity.length||_.contains(n.rarity,i.Rarity))&&(t===""?!0:(i.CustomName||"").toLowerCase().indexOf(t)!==-1||i.Name.toLowerCase().indexOf(t)!==-1)&&(!n.elements.length||utility.arrayMatchAll(i.Elements,n.elements))});r.dragons=r.pagingItem(i)},500)},r.hasFilter=function(){return r.filterModel.dragonName||r.filterModel.rarity},r.rarityClick=function(n){r.filterModel.rarity=n;r.filterDragon()},r.onElementSelected=function(n){r.filterModel.elements=n;r.filterDragon()},r}return __extends(t,n),t}(n.ListPageBaseController);n.DragonListPageBaseController=t})(Shared||(Shared={}));
var Shared;(function(){var n=function(){function n(n){var t=this;this.$onInit=function(){};this.slide={isOpen:!1,size:"400px",title:"Actions",params:{},buttons:[]};n.$watch("vm.slide.isOpen",function(n,i){var r,u;n!==i&&n?(t.scrollbarWidthPx||(r=0,window.getComputedStyle&&(u=window.getComputedStyle(document.body),u&&(r=parseInt(u.marginRight,10))),t.scrollbarWidthPx=r+(window.innerWidth-document.body.clientWidth)),$("body").css("overflow","hidden").css("margin-right",t.scrollbarWidthPx)):$("body").css("overflow","auto").css("margin-right",0);t.slide.element&&(t.slide.element.siblings("pageslide").removeClass("page-slide-shadow"),t.slide.element.addClass("page-slide-shadow"))})}return n.$inject=["$scope"],n}();app.controller("mainPageCtrl",n)})(Shared||(Shared={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(){var n=Shared.PageBaseController,t=function(n){function t(t,i,r,u,f){var e=n.call(this,t,i)||this;e.$scope=t;e.progressBarService=i;e.dragonFactoryService=r;e.mazeIslandService=u;e.messageService=f;e.$onInit=function(){};e.getMazeIsland=function(){e.startRequest();e.mazeIslandService.getEvent().then(function(n){var i=n.config,t=n.userData,r=_.reduce(i.nodes,function(n,t){return n[t.id]=t,n},{});t.claimedReward=_.reduce(t.claimedRewardNodes,function(n,t){return n[t]=!0,n},{});_.forEach(i.paths,function(n){n.node={};n.thumbUrl=e.dragonFactoryService.getImageThumbFromType(n.dragon_type);_.forEach(n.nodes,function(i){var u=n.node[i]=r[i];u.canCollect=u.reward?!t.claimedReward[i]:i>=t.paths[n.id].dragon.currentNode})});e.model=n;e.activePath=e.model.config.paths[0].id}).finally(e.finishRequest)};e.canCollect=function(n,t){return n&&t?n.reward?!e.model.userData.claimedReward[n.id]:n.id>=e.model.userData.paths[t.id].dragon.currentNode:!1};e.getPath=function(n){return _.find(e.model.config.paths,function(t){return t.id===n})};e.getProgress=function(n){var t=e.model.userData.paths[n.id].dragon.currentNode,i=n.nodes.indexOf(t)+1;return i/n.nodes.length*100};e.jump=function(n,t){e.startRequest();e.mazeIslandService.collectItem(n).then(function(i){i.success&&(e.refreshUserInfo(i),e.model.userData.claimedReward[n.id]=!0,e.model.userData.paths[t.id].dragon.currentNode=n.id,e.model.userData.newEventPoints=-n.cost.ep,e.model.userData.eventPoints-=n.cost.ep,n.encounter&&(n.BeatenEnemies+=1))}).finally(e.finishRequest)};e.getThumb=function(n){if(n){var t=e.getPath(n);return t.thumbUrl}return null};$(document).on(Shared.EventName.userInfoLoaded,function(){e.model=null});$(document).on(Shared.TabName.mazeIsland,function(){e.model||e.getMazeIsland()});return e}return __extends(t,n),t.$inject=["$scope","progressBarService","dragonFactoryService","mazeIslandService","messageService"],t}(n);app.controller("mazeIslandCtrl",t)})(App||(App={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(){var n=Shared.DragonListPageBaseController,t=function(n){function t(t,i,r,u,f,e,o,s,h,c){var l=n.call(this,t,r)||this;l.$scope=t;l.$filter=i;l.$timeout=r;l.$location=u;l.progressBarService=f;l.progressHubService=e;l.dragonFactoryService=o;l.countDownService=s;l.messageService=h;l.userInfoContext=c;l.slideSize="80%";l.selectedSkillIndex=0;l.predefinedMode={"default":0,menu:1,feed:2,learnSkill:3,confirm:4,moveHabitat:5};l.predefinedSlideMode={none:0,habitat:1,attackSkill:2,rescureDragon:3};l.$onInit=function(){};l.loadDragon=function(){l.dragonFactoryService.getDragonsOnMap().then(function(n){l.buildImageUrl(n);l.orgDragons=n;l.createConfirmButton();l.finishRequest();l.hasFilter()?l.filterDragon():l.dragons=l.pagingItem(angular.copy(n))})};l.reloadHabitats=function(){l.$scope.$root.$broadcast(Shared.EventName.reloadHabitat)};l.buildImageUrl=function(n){_.each(n,function(n){n.ImageUrl=l.dragonFactoryService.getImageUrl(n)})};l.updateName=function(n){l.$timeout(function(){n.OldName.trim()!==n.CustomName.trim()&&(l.startRequest(),l.dragonFactoryService.updateName(n).finally(l.finishRequest))},500)};l.onDragonClick=function(n){l.selectedDragon&&l.selectedDragon!==n&&(l.selectedDragon.mode=l.predefinedMode.default);l.selectedDragon=n;n.mode=l.predefinedMode.menu};l.openHabitat=function(){l.isOpenSlide=!0;l.slideMode=l.predefinedSlideMode.habitat;l.slideSize="70%"};l.onHabitatClick=function(n,t){l.isOpenSlide=!1;l.startRequest();l.dragonFactoryService.moveDragonToHabitat(l.selectedDragon.Id,n.id).then(function(i){if(i.success){var r=_.find(t,function(n){return n.id===l.selectedDragon.HabitatId});r.CurrentDragons--;l.selectedDragon.HabitatId=n.id;l.reloadHabitats()}}).finally(l.finishRequest)};l.onSellClick=function(n){l.confirmCommand="sell";l.showConfirmForSellAndStore(n)};l.onMoveToDragonarium=function(n){l.confirmCommand=Shared.EventName.moveDragonToDragonarium;l.showConfirmForSellAndStore(n)};l.onDeleteDragon=function(n){l.confirmCommand=Shared.EventName.deleteDragon;l.showConfirmForSellAndStore(n)};l.onStoreClick=function(n){l.confirmCommand="store";l.showConfirmForSellAndStore(n)};l.feedDragonClick=function(n){n.mode=l.predefinedMode.feed};l.showConfirmForSellAndStore=function(n){l.confirmMessage=l.confirmCommand==="store"?l.messageService.storeDragonWarning:"";n.mode=l.predefinedMode.confirm};l.onFeedCancel=function(){l.selectedDragon.mode=l.predefinedMode.menu};l.onFeedOk=function(n){var t,i;l.selectedDragon.mode=l.predefinedMode.default;t=l.selectedDragon.Level;l.startRequest();i=_.find(l.dragons,function(n){return n.Id===l.selectedDragon.Id});i.Level="...";l.dragonFactoryService.feedDragon(l.selectedDragon.Id,t,n).then(function(r){i.Level=r.success?r.result&&r.result.newLevel||t+(n-t):t;l.refreshUserInfo(r)}).finally(l.finishRequest)};l.createConfirmButton=function(){var n={title:"No",disabled:!1,onClick:function(){return l.clearSelectedDragon()}},t={title:"Yes",disabled:!1,onClick:function(){var i,u,r;l.startRequest();u=_.find(l.dragons,function(n){return n.Id===l.selectedDragon.Id});l.confirmCommand==="sell"?i=l.dragonFactoryService.sellDragon(l.selectedDragon.Id):l.confirmCommand==="store"?i=l.dragonFactoryService.storeDragon(l.selectedDragon.Id):l.confirmCommand===Shared.EventName.moveDragonToDragonarium?i=l.dragonFactoryService.moveDragonToDragonarium(l.selectedDragon.Id):l.confirmCommand===Shared.EventName.deleteDragon&&(r=l.userInfoContext.user.dragonarium,i=l.dragonFactoryService.deleteDragon(l.selectedDragon.Id,!(r.slots.length&&r.slots[0].id)));n.disabled=t.disabled=l.isLoading=!0;i.then(function(n){n.success&&(u.isDeleted=!0,l.confirmCommand===Shared.EventName.moveDragonToDragonarium&&l.$scope.$root.$broadcast(Shared.EventName.moveDragonToDragonarium,l.selectedDragon.Id),l.confirmCommand=="store"&&window.refreshEggInStore(),l.clearSelectedDragon())}).finally(function(){n.disabled=t.disabled=l.isLoading=!1;l.finishRequest()})}};l.confirmButtons=[t,n]};l.onFocusSelectedDragon=function(n){var t=$(n.target);(t.hasClass("section")||t.hasClass("animation-hide")||t.hasClass("dragon-box"))&&l.clearSelectedDragon()};l.clearSelectedDragon=function(){l.selectedDragon&&(l.selectedDragon.mode=l.predefinedMode.default,l.selectedDragon=null)};l.openSkillSelector=function(n,t){l.isOpenSlide=!0;l.slideMode=l.predefinedSlideMode.attackSkill;l.slideSize="450px";l.selectedSkillIndex=n;l.selectedDragonSkill=t};l.onSkillCancel=function(){return l.clearSelectedDragon()};l.getAttackSkillTooltip=function(n){return window.attackSkill[n]};l.learnSkillClick=function(){l.startRequest();l.dragonFactoryService.learnSkill(l.selectedDragonSkill.Id,l.selectedSkillIndex,l.selectedTargetSkill.Id).then(function(n){n.success&&(l.selectedDragonSkill.AttackSkills[l.selectedSkillIndex]=l.selectedTargetSkill,l.selectedDragonSkill.WorkId=1,l.loadDragon())}).finally(l.finishRequest);l.isOpenSlide=!1};l.getMyDragonStuckClick=function(n){l.openSlide(l.predefinedSlideMode.rescureDragon,"50%");l.$location.path("RescureDragon/"+n.Id)};l.getDragonBreedingClick=function(n){var t=l.countDownService.getCachedCountDown(n.Id);if(t>0){alert(l.messageService.dragonIsWorking);return}l.startRequest();l.dragonFactoryService.getMyDragonFromBreeding(n.WorkId).then(function(t){t.success&&(_.each(l.orgDragons,function(t){t.WorkId===n.WorkId&&(n.IsBreeding=!1)}),window.refreshEggOnHatchery())}).finally(l.finishRequest)};l.getMyDragonBackClick=function(n){var t=l.countDownService.getCachedCountDown(n.Id);if(t>0){alert(l.messageService.dragonIsWorking);return}l.startRequest();l.dragonFactoryService.getMyDragonBack(n).then(function(t){t.success&&(n.IsStuck=n.IsWoring=n.IsTraining=!1,n.WorkingSecondsLeft=0,n.AttackSkills[t.result.index]=utility.toUpper(t.result.newSkill))}).finally(l.finishRequest)};l.shouldShowSellButton=function(n){return!(n.IsStuck||n.IsTraining||n.IsBreeding||n.IsInTower)};l.pageChanged=function(){l.filterDragon()};l.slideMode=l.predefinedSlideMode.none;l.filterModel={dragonName:"",rarity:[],elements:[]};$(document).on(Shared.TabName.myDragon,function(){l.startRequest();l.loadDragon()});return l.dragonRarities=l.dragonFactoryService.getRarities(),l.$scope.$watch("vm.isOpenSlide",function(n,t){var i,r;n!==t&&n?(l.scrollbarWidthPx||(i=0,window.getComputedStyle&&(r=window.getComputedStyle(document.body),r&&(i=parseInt(r.marginRight,10))),l.scrollbarWidthPx=i+(window.innerWidth-document.body.clientWidth)),$("body").css("overflow","hidden").css("margin-right",l.scrollbarWidthPx),l.slideElement.siblings("pageslide").removeClass("page-slide-shadow"),l.slideElement.addClass("page-slide-shadow")):($("body").css("overflow","auto").css("margin-right",0),l.$location.path("/"))}),l}return __extends(t,n),t.prototype.openSlide=function(n,t){this.slideSize=t;this.isOpenSlide=!0;this.slideMode=n},t.$inject=["$scope","$filter","$timeout","$location","progressBarService","progressHubService","dragonFactoryService","countDownService","messageService","userInfoContext"],t}(n);app.controller("myDragonCtrl",t)})(App||(App={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(){var n=Shared.DragonListPageBaseController,t=function(n){function t(t,i,r,u,f,e){var o=n.call(this,t,i)||this;return o.$scope=t,o.$timeout=i,o.progressBarService=r,o.dragonFactoryService=u,o.offerDragonsService=f,o.messageService=e,o.$onInit=function(){},o.rarityClick=function(n){o.filterModel.rarity=n;o.filterDragon()},o.loadDragon=function(){o.startRequest();o.offerDragonsService.getOffers().then(function(n){n=utility.toUpper(n);o.buildImageUrl(n);o.orgDragons=n;o.finishRequest();o.hasFilter()?o.filterDragon():o.dragons=o.pagingItem(angular.copy(n))}).finally(o.finishRequest)},o.buildImageUrl=function(n){_.each(n,function(n){n.ImageUrl=o.dragonFactoryService.getImageUrl(n)})},o.pageChanged=function(){o.filterDragon()},o.buyOfferDragonClick=function(n){var t=window.confirm(o.messageService.areYouSure);t&&(o.startRequest(),o.offerDragonsService.buyOffer(n).then(function(n){o.refreshUserInfo(n);window.refreshEggInStore();o.messageService.showMessage("Done. Please check Egg In Store")}).finally(o.finishRequest))},o.loadDragon(),o.filterModel={dragonName:"",rarity:[],elements:[]},o.dragonRarities=o.dragonFactoryService.getRarities(),o}return __extends(t,n),t.$inject=["$scope","$timeout","progressBarService","dragonFactoryService","offerDragonsService","messageService"],t}(n);app.controller("offerDragonsCtrl",t)})(App||(App={}));
var App;(function(n){var t;(function(){var n=function(){function n(n,t){var i=this;this.$scope=n;this.$http=t;this.$onInit=function(){};this.getActivePackage=function(){i.$http.post("/BuyPackage/GetActivePackage/7",null).then(function(n){i.packages=n.data})}}return n.$inject=["$scope","$http"],n}();app.controller("packageCtrl",n)})(t=n.Package||(n.Package={}))})(App||(App={}));
app.config(["$routeProvider",function(n){n.when("/RescureDragon/:dragonId",{templateUrl:"/Scripts/App/RescureDragon/index.html",controller:"rescureDragonCtrl",controllerAs:"vm"}).when("/Craft/:crystalTypeId/:crystalId",{templateUrl:"/DeityWorld/Index",controller:"crystalCraftDetailCtrl",controllerAs:"vm"}).when("/Heroic/Progress",{templateUrl:"/EventIsLand/HeroicProgress",controller:"crystalCraftDetailCtrl",controllerAs:"vm"}).when("/Habitat/Move",{templateUrl:"/Habitat/List",controller:"habitatListCtrl",controllerAs:"vm"}).when("/OpenMap",{templateUrl:"/Scripts/App/IronMan/MapInfo.html"}).when("/Buy/Item",{templateUrl:"/BuyItem",controller:"buyItemCtrl",controllerAs:"vm"}).when("/Dragons",{templateUrl:"/Dragon/GetAll"}).when("/Breeding/:femaleId/:femaleName/:maleId/:maleName/:buildingId/:buildingName",{templateUrl:"/Breeding/Index"}).when("/Tournament/ViewAllTournaments",{templateUrl:"/Tournament/ViewAllTournaments",controller:"viewAllTournamentsCtrl",controllerAs:"vm"}).when("/Breeding/SelectDragons",{templateUrl:"/Code?hasLayout=false"}).when("/SetAttackTeam/ArenaDefense",{templateUrl:"/Home/SetAttackTeam?mode=2"}).when("/SetAttackTeam/ArenaAttack",{templateUrl:"/Home/SetAttackTeam?mode=3"}).when("/SetAttackTeam/Pvp",{templateUrl:"/Home/SetAttackTeam?mode=1"}).when("/SetAttackTeam/Tournament",{templateUrl:"/Home/SetAttackTeam?mode=0"}).when("/SetAttackTeam/TrainingDragonStar",{templateUrl:"/Home/SetAttackTeam?mode=4"}).when("/HistoryLog",{templateUrl:"/HistoryLog/Index"}).when("/HistoryLog/Transfer",{templateUrl:"/HistoryLog/Transfer"}).when("/Breeding/GlobalHistory",{templateUrl:"/Breeding/GlobalHistory"}).when("/Tutorial",{templateUrl:"/Scripts/App/Tutorial/tutorial.partial.html"}).when("/Battleground/ExhaustedDragons/:trackId",{templateUrl:"/Battleground/ExhaustedDragons"}).when("/OfferDragons",{templateUrl:"/Buy/OfferDragons"})}]);
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(){var n=Shared.PageBaseController,t=function(n){function t(t,i,r,u,f,e,o,s,h,c,l){var a=n.call(this,t,e)||this;a.$scope=t;a.$timeout=i;a.$location=r;a.userStoreService=u;a.socialService=f;a.progressBarService=e;a.progressHubService=o;a.tournamentService=s;a.dragonFactoryService=h;a.messageService=c;a.userInfoContext=l;a.isLoading=!1;a.isStartCountDown="false";a.isUserInfoLoaded=!1;a.countDownPuzzleIsland=15;a.startCountDownPuzzleIsland=!1;a.isPuzzleIslandItemCollected=!1;a.$onInit=function(){};a.getGemsClick=function(){a.startRequest();a.userStoreService.getGems().then(function(n){n.success&&(a.refreshUserInfo(n),a.model.videoAdvs.DragonCinema.VideosPending=n.state.videoAds.dragonCinema.videosPending)}).finally(a.finishRequest)};a.getGemsAndOrbsClick=function(){a.startRequest();a.userStoreService.getGemsAndOrbs().then(a.refreshUserInfo).finally(a.finishRequest)};a.claimPuzzleReward=function(){a.startRequest();a.userStoreService.claimPuzzleReward().then(function(n){n.success&&(a.refreshUserInfo(n),a.messageService.showMessage("Done."));a.isPuzzleIslandItemCollected=!1;a.startCountDownPuzzleIsland=!0}).finally(a.finishRequest)};a.collectPuzzleItemsClick=function(){a.startRequest();a.userStoreService.collectPuzzleItems().then(function(n){n.success?(a.messageService.showMessage("Done. Please login your game and claim reward."),a.isPuzzleIslandItemCollected=!0):a.model.puzzleExpired=n.result}).finally(a.finishRequest)};a.puzzleIslandCountDownStop=function(){a.startCountDownPuzzleIsland=!1;a.autoClaiming&&(a.startRequest(),a.userStoreService.collectAndClaimPuzzleIsland().then(function(){a.autoClaiming=!0}).catch(function(){a.userInfoContext.getUserInfo().then(function(){a.autoClaiming=!0})}).finally(function(){a.finishRequest()}),a.autoClaiming=!1);a.$scope.$apply()};a.startAutoClaimClick=function(n){a.autoClaiming=n};a.buyExp=function(){a.startRequest();a.userStoreService.buyExp().then(function(n){n.success&&a.refreshUserInfo(n)}).finally(a.finishRequest)};a.inviteFriendMarket=function(){a.isLoading=!0;a.progressHubService.hubStart().then(function(){a.socialService.inviteFriendMarket().then(function(){}).finally(function(){a.isLoading=!1;a.progressBarService.set(100)})});a.progressHubService.onProgressChanged=function(n){a.progressBarService.set(n)}};a.getFoodClick=function(){a.getFood(!1)};a.sendFoodClick=function(){};a.fixCombatErrorClick=function(){a.startRequest();a.tournamentService.fixCombatError().then(function(n){n.success&&a.messageService.showMessage(n.message,2e4)}).finally(a.finishRequest)};a.storeAllAndMoveHabitatClick=function(){var n=window.confirm("BE CAREFULL !!! This feature will reset all your dragons stars and skills were learned for all dragons. Are you sure you want to continue ?");n&&(a.startRequest(),a.dragonFactoryService.storeAndMoveAllDragonsToHabitat().then(function(){}).finally(a.finishRequest))};a.getFood=function(n){a.isLoading=!0;a.progressHubService.hubStart().then(function(){var t;t=n?a.socialService.sendFoodAsGift():a.socialService.getFood();t.then(a.refreshUserInfo).finally(a.finishRequest)});a.progressHubService.onProgressChanged=function(n){a.progressBarService.set(n)}};a.loadFreeDragons=function(){a.userStoreService.loadDragonFree().then(function(n){a.freeDragons=n.dragons;a.claimedDragons=n.removed;a.selectedDragonObstacle=n.dragons[0]})};a.loadSpecialPrice=function(){a.userStoreService.getSpecialPrice().then(function(n){_.each(n,function(n){var t=_.filter(n.rewards,function(n){return n.seggs});t.length&&(n.itemId=t[0].seggs[0].id)});a.specialPrices=n;a.selectedPrice=n[0]})};a.buySpecialPrice=function(n){confirm(a.messageService.areYouSure)&&(a.startRequest(),a.userStoreService.buyWithSpecialPrice(n.level).then(function(n){n.success&&(a.refreshUserInfo(n),a.messageService.showMessage("Done. Please reload user information then check Storage"))}).finally(a.finishRequest))};a.claimDragon=function(n){a.startRequest();a.userStoreService.claimDragon(n).then(function(t){t.success&&(a.messageService.showMessage("Done. Please check Egg In Store"),window.refreshEggInStore(),a.claimedDragons=a.claimedDragons||{},a.claimedDragons[n.id]=n.id)}).finally(a.finishRequest)};a.openOfferDragonsSlideClick=function(){a.mainSlide.isOpen=!0;a.mainSlide.size="80%";a.mainSlide.title="Offers";a.$location.path("/OfferDragons")};a.autoClaiming=!1;$(document).on(Shared.TabName.wonderWoman,function(){a.loadFreeDragons();a.loadSpecialPrice()});$(document).on(Shared.EventName.userInfoLoaded,function(n,t){a.model={};t.success&&(a.isUserInfoLoaded=!0,a.model.videoAdvs=t.result.videoAdvs,a.model.puzzleIslandMoveLeft=t.result.puzzleIslandMoveLeft,a.model.videoAdvs&&a.model.videoAdvs.DragonCinema.SecondsLeft>0&&(a.isStartCountDown="true"))});return a}return __extends(t,n),t.$inject=["$scope","$timeout","$location","userStoreService","socialService","progressBarService","progressHubService","tournamentService","dragonFactoryService","messageService","userInfoContext"],t}(n);app.controller("tabOtherCtrl",t)})(App||(App={}));
var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Shared;(function(n){var t;(function(){var t=function(n){function t(t,i,r){var u=n.call(this,t,r)||this;return u.$scope=t,u.$http=i,u.progressBarService=r,u.$onInit=function(){u.startRequest();u.$http.post("/HistoryLog/GetLogs",null).then(function(n){return u.model=n.data}).finally(u.finishRequest)},u}return __extends(t,n),t.$inject=["$scope","$http","progressBarService"],t}(n.PageBaseController);app.controller("taskScheduleLogCtrl",t)})(t=n.App||(n.App={}))})(Shared||(Shared={}));
var Test;(function(n){var t;(function(){var n=function(){function n(n,t,i,r){var u=this;this.$scope=n;this.$http=t;this.progressBarService=i;this.progressHubService=r;this.$onInit=function(){};this.sendRequest=function(){u.isLoading=!0;u.$http.post("/TestParam/SendRequest",u.model).then(function(n){u.isLoading=!1;u.model.result=JSON.stringify(n.data)})};this.getUserInfo=function(){u.$http.post("/UserSession/GetUserInformation",null).then(function(n){u.user=n.data})};this.getItemOnMap=function(){u.$http.post("/Home/GetItemOnMap",null).then(function(n){u.itemsOnMap=n.data})};this.getDragonOnMap=function(){u.$http.post("/Dragon/GetDragonOnMap",null).then(function(n){u.dragonsOnMap=n.data})};this.getAllItems=function(){u.$http.post("/TestParam/GetAllItems",null).then(function(n){var t=JSON.parse(n.data.toString());u.itemsInStore=_.values(t)})};this.getAllCommands=function(){u.$http.post("/TestParam/GetAllCommands",null).then(function(n){var t=JSON.parse(n.data.toString());u.allCommands=t})};this.registerRequest=function(){u.progressHubService.hubStart().then(function(){u.$http.get("/TestParam/segmentNoDb",null).then(function(n){var t=JSON.parse(n.data.toString());u.allCommands=t})});u.progressHubService.onProgressChanged=function(n){u.progressBarService.set(n);console.log(n)}};this.addCommand=function(n){u.model.requestCommand=n.Value};this.addArgs=function(n){u.model.requestArgs=n.Id};this.getGold=function(){u.isLoading=!0;u.$http.post("/TestParam/GetGold",null).then(function(n){u.newUser=n.data;u.isLoading=!1})};this.isLoading=!1;this.getItemOnMap();this.getAllCommands();this.getAllItems();this.getDragonOnMap();this.getUserInfo();this.model={requestCommand:"",requestArgs:"",postedValues:"",platform:"android"}}return n.$inject=["$scope","$http","progressBarService","progressHubService"],n}();app.controller("testParams",n)})(t=n.Params||(n.Params={}))})(Test||(Test={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(n){var t;(function(){var n=Shared.PageBaseController,t=function(n){function t(t,i,r,u,f,e){var o=n.call(this,t,e)||this;return o.$scope=t,o.$location=i,o.$timeout=r,o.userInfoContext=u,o.treeOfLifeService=f,o.progressBarService=e,o.$onInit=function(){},o.init=function(){o.treeOfLifeService.get().then(function(){})},o}return __extends(t,n),t.$inject=["$scope","$location","$timeout","userInfoContext","treeOfLifeService","progressBarService"],t}(n);app.controller("treeOfLifeCtrl",t)})(t=n.DeityWorld||(n.DeityWorld={}))})(App||(App={}));
var App;(function(){var n=function(){function n(n,t){var i=this;this.$scope=n;this.messageService=t;this.$onInit=function(){i.model=[{Link:"https://youtu.be/HoCqXjesLKk",Title:"How to find facebookId and SessionId"},{Link:"https://youtu.be/h30RItZgnVI",Title:"How to create token link for mobile device"},{Link:"https://youtu.be/wXYNpKsMpds",Title:"How to open Dragon Market without invite friends"},{Link:"https://youtu.be/XxZ9M_4U2Nk",Title:"How to get some Dragons free in Recuriment Tarven without invite friends"},{Link:"https://youtu.be/uhIpAImLY0U",Title:"How to training Dragon Stars (Premium Account)"},{Link:"https://youtu.be/JYn1h6pmEok",Title:"How to training multiple dragons same time (Premium Account)"}]};this.$onInit()}return n.$inject=["$scope","messageService"],n}();app.controller("tutorialCtrl",n)})(App||(App={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(){var n=Shared.PageBaseController,t=function(n){function t(t,i,r,u,f){var e=n.call(this,t,r)||this;e.$scope=t;e.$location=i;e.progressBarService=r;e.userInfoContext=u;e.dragonFactoryService=f;e.isLoading=!1;e.$onInit=function(){};e.getValue=function(n){return $("#"+n).val().indexOf("**")>-1?$.trim($("#"+n)[0].temp):$.trim($("#"+n).val())};e.changeMode=function(){e.isMarkMode=!e.isMarkMode;e.storeFbIdAndSessionIdValueToDom()};e.showMoreInfo=function(){e.shouldShowMoreInfo=!e.shouldShowMoreInfo};e.storeFbIdAndSessionIdValueToDom=function(){$("#txtFbid")[0].temp=e.facebookId;$("#txtUserKey")[0].temp=e.sessionId};e.tutorialClick=function(){e.mainSlide.isOpen=!0;e.mainSlide.title="Tutorial";e.$location.path("/Tutorial")};e.getBannedText=function(n){return n.replace(/-/g,", ")};e.isSafe=function(){return!e.userInfo.UserBanned&&!e.userInfo.HackWarning};e.isMarkMode=!1;e.shouldShowMoreInfo=!1;$(document).on("userInfoClick",function(){e.startRequest()});$(document).on("userInfoLoaded",function(n,t){e.finishRequest();t&&t.result&&(e.facebookId=e.getValue("txtFbid"),e.sessionId=e.getValue("txtUserKey"),e.dragonFactoryService.dragonsOnMap=null,e.userInfoContext.saveUserContext(t.result,e.facebookId,e.sessionId),e.userInfo=t.result.userInfo,e.$scope.$root.$broadcast(Shared.EventName.userInfoLoaded),e.storeFbIdAndSessionIdValueToDom(),e.isMarkMode=!0,e.$scope.$apply())});$(document).on(Shared.EventName.onHatcheryRefresh,function(n,t){e.$scope.$root.$broadcast(Shared.EventName.onHatcheryRefresh,t.result)});return e.$scope.$on(Shared.EventName.refreshUserInfo,function(n,t){t.g&&$("#lblGold").text(t.g);t.f&&$("#lblFood").text(t.f);t.c&&$("#lblGems").text(t.c);t.x&&$("#lblXp").text(t.x);t.level&&$("#lblLevel").text(t.level)}),e.facebookId=$.cookie("txtFbid"),e.sessionId=$.cookie("txtUserKey"),e}return __extends(t,n),t.$inject=["$scope","$location","progressBarService","userInfoContext","dragonFactoryService"],t}(n);app.controller("userInfoCtrl",t)})(App||(App={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Store;(function(n){var t;(function(){var i=Shared.PageBaseController,n,t;(function(n){n[n.None=0]="None";n[n.Gold=1]="Gold";n[n.GoldAndXp=2]="GoldAndXp";n[n.Food=3]="Food";n[n.Gems=4]="Gems"})(n||(n={}));t=function(t){function i(i,r,u,f,e,o,s){var h=t.call(this,i,f)||this;h.$scope=i;h.$http=r;h.$location=u;h.progressBarService=f;h.progressHubService=e;h.userStoreService=o;h.messageService=s;h.isTransfering=!1;h.eventLog=[];h.report={avg:0,start:0,end:0,total:0};h.$onInit=function(){};h.isValid=function(){return h.tryShowConfirmMsgWhenUsingMobile()?(h.submitTime>=5&&h.submitTime<=999)?!0:(h.messageService.showMessage("Please input valid submit time. Min:10 - Max:999 seconds"),!1):!1};h.startTransferGemClick=function(){h.isValid()&&(h.isStart=1,h.totalSeconds=h.submitTime,h.transferMode=n.Gems,h.appendLog(h.messageService.wating+" "+h.totalSeconds+" "+h.messageService.second+"..."))};h.startTransferGoldClick=function(){h.isValid()&&(h.transferMode=n.Gold,h.report.start=new Date,h.totalSeconds=h.submitTime,h.isStart=1,h.appendLog(h.messageService.wating+" "+h.totalSeconds+" "+h.messageService.second+"..."))};h.startTransferGoldAndXpClick=function(){h.isValid()&&(h.transferMode=n.GoldAndXp,h.report.start=new Date,h.totalSeconds=30,h.isStart=1,h.appendLog(h.messageService.wating+" "+h.totalSeconds+" "+h.messageService.second+"..."))};h.startTransferFoodClick=function(){h.isValid()&&(h.transferMode=n.Food,h.isStart=1,h.totalSeconds=h.submitTime,h.appendLog(h.messageService.wating+" "+h.totalSeconds+" "+h.messageService.second+"..."),h.progressHubService.onProgressChanged=function(n){h.progressBarService.set(n)})};h.onTicks=function(n){h.isTransfering||(n&&parseInt(n.replace(/:/g,""))<=0?(h.isTransfering=!0,h.timeLeftString=h.messageService.transfering+"..."):h.timeLeftString=n)};h.onCountDownReached=function(){h.progressHubService.hubStart().then(function(){switch(h.transferMode){case n.Gold:h.transferGold(!1);break;case n.GoldAndXp:h.transferGold(!0);break;case n.Food:h.transferFood();break;case n.Gems:h.transferGem()}})};h.onSendResourceCompleted=function(n){h.oldResource.food!==n.result.food&&(h.userResource.food=kendo.format("{0:#,#} => {1:#,#}",h.oldResource.food,n.result.food));h.oldResource.gem!==n.result.gem&&(h.userResource.gem=kendo.format("{0:#,#} => {1:#,#}",h.oldResource.gem,n.result.gem))};h.transferGold=function(n){h.beginLogMessage();h.$http.post(n?"/UserResource/TransferGoldWithXp":"/UserResource/TransferGold",null,{headers:{ConnectionId:h.progressHubService.getConnectionId()}}).then(function(n){h.updateMainInfo(n.data);h.completedLogMessage(n.data,"g")}).finally(function(){h.isTransfering=!1;h.isStart=1;h.progressBarService.complete();h.appendLog(h.messageService.wating+" "+h.totalSeconds+" "+h.messageService.second+"...")})};h.transferFood=function(){h.beginLogMessage();h.$http.post("/UserResource/TransferFood",null).then(function(n){h.updateMainInfo(n.data);h.completedLogMessage(n.data,"f")}).finally(function(){h.isTransfering=!1;h.isStart=1;h.progressBarService.complete();h.appendLog("Waiting "+h.totalSeconds+" seconds...")})};h.transferGem=function(){h.progressBarService.set(4);h.beginLogMessage();h.$http.post("/UserResource/TransferGem",null).then(function(n){h.updateMainInfo(n.data);h.completedLogMessage(n.data,"c")}).finally(function(){h.isTransfering=!1;h.isStart=1;h.progressBarService.set(100);h.appendLog("Waiting "+h.totalSeconds+" seconds...")})};h.shouldShowGetReward=function(){return h.$http.post("/UserResource/ShouldShowGetReward",null).then(function(n){return n.data})};h.claimReward=function(){return popup.close(),h.startRequest(),h.userStoreService.claimReward().then(function(n){var t=n;return h.userResource={gold:t.g,food:t.f||0,gem:t.c||0},t}).finally(h.finishRequest)};h.stopTransferClick=function(){h.appendLog(h.messageService.stop);h.isTransfering=!1;h.isStart=0;h.transferMode=n.None};h.getGemsClick=function(){return h.userStoreService.getGems().then(function(){})};h.getClassForValidAccount=function(){return h.isMoreThanDays(90)?"glyphicon-ok text-success":"glyphicon-remove text-danger"};h.isMoreThanDays=function(n){var t=new Date,i=Math.abs(t-h.accountRegisteredDate);return i/864e5>n};h.viewLogClick=function(){h.mainSlide.isOpen=!0;h.mainSlide.size="50%";h.mainSlide.title="Transfer History Logs";h.$location.path("/HistoryLog/Transfer")};h.updateMainInfo=function(n){var t=JSON.parse(n.result);t&&(h.userResource.gold=t.gold,h.userResource.food=t.food,h.userResource.gem=t.gem);h.refreshUserInfo(n)};h.showExpiredDate=function(n){var i=kendo.toString(kendo.parseDate(n.data.expiredDate),"yyyy-MM-dd HH:mm"),t=$("#lblExpiredDate");t.removeClass("hide");t.text(i);t.closest("table").find(".expired-date").removeClass("hide")};h.beginLogMessage=function(){h.appendLog(h.messageService.beginTransfer)};h.showAvg=function(){var n=Date.parse((new Date).toString())-Date.parse(h.report.start),t=n/1e3;return 120*h.report.total/t};h.completedLogMessage=function(n,t){var i,r,u;n.success&&(i="",t==="c"?i=kendo.format("Gem:{0} | Food:{1} | Gold: {2}",n.c||0,n.f||0,n.g||0):(r=(t==="g"?n.g:n.f).split("(")[1].replace(/\)/i,""),u=t==="g"?"Gold":"Food",h.report.total+=parseFloat(r.replace(/\+/,"").replace(/\./g,"").replace(/,/g,"")||"0"),i=h.messageService.total+" "+(r||0)+" "+u),h.appendLog(i))};h.now=function(){return kendo.toString(new Date,"hh:mm:ss")};h.appendLog=function(n){h.eventLog.push("["+h.now()+"]:"+n)};h.isMobileBrowser=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)};h.tryShowConfirmMsgWhenUsingMobile=function(){return h.isMobileBrowser()?confirm(h.messageService.warningTransfer):!0};h.timeLeftString=h.messageService.starting+"...";h.oldResource={};h.submitTime=5;$(document).on(Shared.EventName.userInfoLoaded,function(n,t){t.success&&(h.shouldShowGetReward().then(function(n){var t=n;t&&popup.show("Message",t.message,0,300)}),h.accountRegisteredDate=kendo.parseDate(t.result.userInfo.RegisteredDate),r.post("/UserResource/GetResource",null).then(function(n){var t,i,r;n.data.expiredDate&&h.showExpiredDate(n);n.data.vipServer||n.data.isLocal||n.data.isValidVipUser&&(t=confirm(h.messageService.confirmSwitchToPremiumServer),t&&(i=$.cookie("txtFbid"),r=$.cookie("txtUserKey"),window.location.href="http://vip.ditlep.com/UserSession/Login?fbId="+i+"&ssId="+r));h.oldResource.gold=n.data.gold;h.oldResource.food=n.data.food;h.oldResource.gem=n.data.gem;n.data.gold=kendo.format("{0:#,#}",n.data.gold);n.data.food=kendo.format("{0:#,#}",n.data.food);n.data.gem=kendo.format("{0:#,#}",n.data.gem);h.userResource=n.data;h.stopTransferClick()}))});$(document).on("onClaimClick",function(n,t){$(t).attr("disabled","disabled");h.claimReward().then(function(){setTimeout(function(){$(".ui-dialog-titlebar-close").click();$("[href=#tab5]").click()},500)})});return h.progressHubService.onLogEvent=function(n){h.appendLog(n);n.toLowerCase().indexOf("stop")>0&&h.stopTransferClick()},h.progressHubService.onProgressChanged=function(n){h.progressBarService.set(n)},h}return __extends(i,t),i.$inject=["$scope","$http","$location","progressBarService","progressHubService","userStoreService","messageService"],i}(i);app.controller("storeCtrl",t)})(t=n.Ui||(n.Ui={}))})(Store||(Store={}));
var App;(function(){var n=function(){function n(n,t){var i=this;this.userSessionService=n;this.progressBarService=t;this.$onInit=function(){};this.getSessionIdClick=function(){i.isLoading=!0;i.progressBarService.start();i.userSessionService.getSessionIdFromSigned(i.signedRequest).then(function(n){i.facebookId=n.facebookId;i.sessionId=n.sessionId}).catch(function(){alert("There are some errors. Please try again")}).finally(function(){i.progressBarService.set(100);i.isLoading=!1})};this.copyToClipboard=function(){var n=$(".copyToClipboard"),t;n.select();try{t=document.execCommand("copy")}catch(i){}}}return n.$inject=["userSessionService","progressBarService"],n}();app.controller("userSessionCtrl",n)})(App||(App={}));
var App;(function(n){var t;(function(){var n=function(){function n(n,t,i,r){var u=this;this.$scope=n;this.$http=t;this.progressBarService=i;this.scratchCardService=r;this.mode=0;this.isLoading=!1;this.cardId=["VIETTEL","VINA","MOBI","GATE"];this.$onInit=function(){u.model={scratchCard:{},package:{selected:{}},userCoin:null};u.result={message:""};u.model.scratchCard={cardId:u.cardId[0]};u.getVnPrice();u.$scope.$watch("vm.mode",function(){u.result.message=""})};this.submitClick=function(){var t=new RegExp("^\\d+$"),n;if(!t.test(u.model.scratchCard.facebookId)){alert("Bạn đã nhâp sai FacebookId, FacebookId phải là 1 chuỗi chỉ chứa số và không có chữ cái. Vui lòng kiểm tra lại");return}(n=window.confirm("Bạn có chắc chắn nạp thẻ không ?"),n)&&(u.isLoading=!0,u.progressBarService.start(),u.scratchCardService.scratch(u.model.scratchCard).then(function(n){u.result=n;u.model.userCoin=n.result}).finally(function(){u.isLoading=!1;u.progressBarService.set(100)}))};this.isValid=function(){return u.model.scratchCard.pin&&u.model.scratchCard.seri&&u.model.scratchCard.facebookId};this.checkCoinClick=function(){u.isLoading=!0;u.progressBarService.start();u.scratchCardService.checkAvailableCoin(u.model.scratchCard).then(function(n){u.model.userCoin=n||{coin:0}}).finally(function(){u.isLoading=!1;u.progressBarService.set(100)})};this.getVnPrice=function(){u.scratchCardService.getVnPrice().then(function(n){n.unshift({name:"--Vui lòng chọn gói--",id:-1,vnPrice:0});u.prices=n;u.model.package.selected=n[0]})};this.buyPackageClick=function(){if(u.model.package.selected.id<=0){alert("Bạn chưa chọn gói cần mua. Vui lòng kiểm tra lại");return}var n=window.confirm("Bạn đang chọn gói "+u.model.package.selected.name+". Bạn có chắc chăn mua hay không?");n&&(u.isLoading=!0,u.progressBarService.start(),u.model.scratchCard.packageId=u.model.package.selected.id,u.scratchCardService.buyPackageWithPoint(u.model.scratchCard).then(function(n){u.result=n;n.success&&(u.model.userCoin=u.model.userCoin?n.result:{coin:n.result.coin})}).finally(function(){u.isLoading=!1;u.progressBarService.set(100)}))}}return n.$inject=["$scope","$http","progressBarService","scratchCardService"],n}();app.controller("scratchCardCtrl",n)})(t=n.BaoKim||(n.BaoKim={}))})(App||(App={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n){var t=this;this.$http=n;this.scratch=function(n){return t.$http.post("/ScratchCard",n).then(function(n){return n.data})};this.checkAvailableCoin=function(n){return t.$http.post("/ScratchCard/CheckPoint",n).then(function(n){return n.data})};this.getVnPrice=function(){return t.$http.post("/ScratchCard/GetVnPrice",null).then(function(n){return n.data})};this.buyPackageWithPoint=function(n){return t.$http.post("/ScratchCard/BuyPackageWithPoint",n).then(function(n){return n.data})}}return n.$inject=["$http"],n}();n.ScratchCardService=t;app.service("scratchCardService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(){var n=Shared.PageBaseController,t=function(n){function t(t,i,r,u,f,e){var o=n.call(this,t,r)||this;o.$scope=t;o.$location=i;o.progressBarService=r;o.dragonFactoryService=u;o.battlegroundService=f;o.messageService=e;o.$onInit=function(){};o.getBattleground=function(){o.startRequest();o.battlegroundService.getBattleground().then(function(n){o.model=n;o.selectedTrack=o.model.config.tracks[0];o.selectedUserDataTrack=_.find(o.model.userData.track_progress,function(n){return n.track_id==o.selectedTrack.id})}).finally(o.finishRequest)};o.fight=function(n){o.startRequest();o.battlegroundService.fight(n).then(function(t){if(t.success&&(o.refreshUserInfo(t),o.selectedUserDataTrack&&o.selectedUserDataTrack.current_node&&(o.selectedUserDataTrack.current_node.id=n+1),t.message&&o.messageService.showMessage(t.message),t.result)){var i=_.find(o.model.userData.track_progress,function(n){return n.track_id===o.selectedTrack.id});i.exhausted_dragons||(i.exhausted_dragons=[]);_.each(t.result,function(n){return i.exhausted_dragons.push(n)})}}).finally(o.finishRequest)};o.getProgress=function(n){var t=_.find(o.model.userData.track_progress,function(t){return t.track_id==n.id}),i,r;return!t||!t.current_node?100:(i=n.nodes,r=i.indexOf(t.current_node.id)+1,r/i.length*100)};o.getThumb=function(n){return o.dragonFactoryService.getImageThumbFromType(n)};o.totalExhaustedDragon=function(n){var t=_.find(o.model.userData.track_progress,function(t){return t.track_id===n.id});return t&&t.exhausted_dragons&&t.exhausted_dragons.length};o.trackClick=function(n){o.selectedTrack=n;o.selectedUserDataTrack=_.find(o.model.userData.track_progress,function(t){return t.track_id==n.id})};o.viewExhaustedDragonsClick=function(n){o.mainSlide.isOpen=!0;o.mainSlide.title="Exhausted Dragons";o.mainSlide.size="50%";o.$location.path("/Battleground/ExhaustedDragons/"+n)};o.resetDragonExhaustedClick=function(n){o.startRequest();o.battlegroundService.resetDragonExhausted(n).then(function(){}).finally(o.finishRequest)};$(document).on(Shared.EventName.userInfoLoaded,function(){o.model=null});$(document).on(Shared.TabName.battleground,function(){o.model||o.getBattleground()});return o}return __extends(t,n),t.$inject=["$scope","$location","progressBarService","dragonFactoryService","battlegroundService","messageService"],t}(n);app.controller("battlegroundCtrl",t)})(App||(App={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(){var n=Shared.PageBaseController,t=function(n){function t(t,i,r,u,f,e){var o=n.call(this,t,r)||this;return o.$scope=t,o.$routeParams=i,o.progressBarService=r,o.dragonFactoryService=u,o.battlegroundService=f,o.messageService=e,o.$onInit=function(){},o.startRequest(),o.battlegroundService.getExhaustedDragon(o.$routeParams.trackId).then(function(n){o.model=n;_.forEach(o.model,function(n){n.workingSecondsLeft>0&&(n.timeLeft=utility.parseFromSecond(n.workingSecondsLeft,"{0}:{1}"))})}).finally(o.finishRequest),o}return __extends(t,n),t.$inject=["$scope","$routeParams","progressBarService","dragonFactoryService","battlegroundService","messageService"],t}(n);app.controller("exhaustedDragonCtrl",t)})(App||(App={}));
var App;(function(n){var t;(function(n){var t=function(){function n(){}return n}();n.BotControllerBase=t})(t=n.Bot||(n.Bot={}))})(App||(App={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n){var t=this;this.$http=n;this.collectGold=function(n){return t.$http.post("/Bot/CollectGold",n).then(function(n){return n.data})};this.activeServerSide=function(n){return t.$http.post("/Bot/ActiveBotServerSide",n).then(function(n){return n.data})};this.getBotConfig=function(){return t.$http.post("/Bot/GetConfig",null).then(function(n){return n.data})}}return n.$inject=["$http"],n}();n.BotService=t;app.service("botService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(n){var t;(function(){var n=Shared.PageBaseController,t=function(n){function t(t,i,r,u,f){var e=n.call(this,t,f)||this;e.$scope=t;e.$location=i;e.$timeout=r;e.botService=u;e.progressBarService=f;e.eventLog=[];e.isUserLoaded=!1;e.$onInit=function(){};e.onCountDownReached=function(){return e.startRequest(),e.beginLogMessage(),e.botService.collectGold(e.model).then(function(n){e.refreshUserInfo(n);e.completedLogMessage(n)}).catch(function(){e.appendLog("Error!!!Try again.")}).finally(function(){e.finishRequest();e.model.isStart=1}),0};e.onStartChange=function(){e.model.isStart=e.model.isStartDummy?1:0;e.model.clientSide.active=e.model.isStart?!0:!1};e.beginLogMessage=function(){var n="["+e.now()+"]: Begin Collect";e.appendLog(n)};e.completedLogMessage=function(n){var t=n.g.split("(")[1].replace(/\)/i,""),i="["+e.now()+"]: Total "+(t||0);e.appendLog(i)};e.now=function(){return kendo.toString(new Date,"hh:mm:ss")};e.appendLog=function(n){e.eventLog.push(n);e.scrollDown()};e.scrollDown=function(){setTimeout(function(){$(".auto-bot .event-log").scrollTop($(".auto-bot .event-log")[0].scrollHeight)},500)};e.serverSideActiveClick=function(){e.$timeout.cancel(e.timeoutSubmit);e.timeoutSubmit=e.$timeout(function(){e.botService.activeServerSide(e.model).then(function(n){e.model=n.result})},1e3)};e.getConfig=function(){e.startRequest();e.botService.getBotConfig().then(function(n){e.model.serverSide=n.serverSide}).finally(e.finishRequest)};e.viewLogClick=function(){e.mainSlide.isOpen=!0;e.mainSlide.size="50%";e.mainSlide.title="History Logs";e.$location.path("/HistoryLog")};e.model={totalSeconds:30,repeat:20,isStart:0,clientSide:{isCollectionGold:!1,isCollectionFood:!1,foodId:1},serverSide:{foodId:3},showCounter:!1};e.growFood=window.growFood;$(document).on("userInfoLoaded",function(){e.isUserLoaded=!0});$(document).on(Shared.TabName.bot,function(){e.getConfig()});return e}return __extends(t,n),t.$inject=["$scope","$location","$timeout","botService","progressBarService"],t}(n);app.controller("goldBotCtrl",t)})(t=n.Bot||(n.Bot={}))})(App||(App={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(n){var t;(function(){var n=function(n){function t(t,i,r,u,f){var e=n.call(this,t,f)||this;e.$scope=t;e.$location=i;e.breedingService=r;e.messageService=u;e.progressBarService=f;e.$onInit=function(){e.breedingHistory=[];e.$scope.$watch(function(){return e.lastResult},function(n,t){n!==t&&setTimeout(function(){var n=$("#lblBreedingResult");n.slideUp();n.slideDown()},200)})};e.getModelValue=function(){return{femaleId:$("#ddlDragonBreeding1").val(),maleId:$("#ddlDragonBreeding2").val(),buildingId:$("#ddlBreeding").val()}};e.openBreedingCalClick=function(){var n=$("#ddlDragonBreeding1"),t=$("#ddlDragonBreeding2"),i=$("#ddlBreeding"),r=n.val(),u=n.find(":selected").attr("name").replace(/ /g,"-"),f=t.val(),o=t.find(":selected").attr("name").replace(/ /g,"-"),s=i.val(),h=i.find(":selected").attr("name").replace(/ /g,"-");e.mainSlide.isOpen=!0;e.mainSlide.size="700px";e.mainSlide.title=e.messageService.breedingResult;setTimeout(function(){e.$location.path("/Breeding/"+r+"/"+u+"/"+f+"/"+o+"/"+s+"/"+h);e.$scope.$apply()},500)};e.openBreedingResultHistory=function(){e.mainSlide.isOpen=!0};e.breedClick=function(){var t=$("#lblBreedingResult"),n=$('button[cmd="StopBreed"]');n.removeAttr("disabled")};e.getHistoryGlobalBreeding=function(){e.startRequest();e.breedingService.getGlobalHistoryBreeding().then(function(n){n.success&&(e.globalHistory=n.result)}).finally(e.finishRequest)};e.refreshClick=function(){e.getHistoryGlobalBreeding()};e.viewAllClick=function(n){e.mainSlide.isOpen=!0;e.mainSlide.size="80%";e.mainSlide.title=n;e.$location.path("/Breeding/GlobalHistory")};e.breedingClick=function(){confirm(e.messageService.areYouSure)&&(e.startRequest(),e.model=e.getModelValue(),e.breedingService.breed(e.model.maleId,e.model.femaleId,e.model.buildingId).then(function(n){n.success&&(e.lastResult=n.result,e.lastResult.createdDate=new Date,e.breedingHistory.push(e.lastResult),window.refreshBreedingResult())}).finally(e.finishRequest))};$(document).on(Shared.TabName.hulk,function(){e.getHistoryGlobalBreeding()});return e}return __extends(t,n),t.prototype.onSlideClose=function(){this.$location.path("")},t.$inject=["$scope","$location","breedingService","messageService","progressBarService"],t}(Shared.PageBaseController);app.controller("breedingCtrl",n)})(t=n.BreedingCalculation||(n.BreedingCalculation={}))})(App||(App={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n){var t=this;this.$http=n;this.calculation=function(n,i,r){return t.$http.post("/Breeding/Calculation",{femaleId:n,maleId:i,buildingId:r}).then(function(n){return n.data})};this.calculate=function(n){return t.$http.post("/Breeding/Calculate",n).then(function(n){return n.data})};this.getGlobalHistoryBreeding=function(){return t.$http.post("/Breeding/GetGlobalHistory",null).then(function(n){return n.data})};this.breed=function(n,i,r){return t.$http.post("/Breeding/BreedDragon",{male:n,female:i,buildingId:r}).then(function(n){return n.data})}}return n.$inject=["$http"],n}();n.BreedingService=t;app.service("breedingService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(n){var t;(function(){var n=Shared.PageBaseController,t=function(n){function t(t,i,r,u,f,e,o){var s=n.call(this,t,e)||this;return s.$scope=t,s.$routeParams=i,s.$location=r,s.$timeout=u,s.breedingService=f,s.progressBarService=e,s.dragonFactoryService=o,s.isLoading=!1,s.$onInit=function(){},s.init=function(){s.model={level:9,sanctuary:0};window.document.title="Breeding Calculation All Dragons - Dragon City";var n=s.$routeParams.maleId,t=s.$routeParams.femaleId,i=s.$routeParams.buildingId;s.calculate(n,t,i);$(document).on("grid.rowSelected",function(n,t){s.mainSlide.isOpen=!1;s.model.selectMode==="f"?s.model.female=t:s.model.male=t;s.model.female&&s.model.male&&s.model.autoCalculate&&s.loadDragons();s.$scope.$apply()});s.$scope.$watch(function(){return s.model},function(n,t){n&&t&&n.male&&n.female&&t.male&&t.female&&(n.male.TypeId!==t.male.TypeId||n.female.TypeId!==t.female.TypeId||n.level!==t.level||n.sanctuary!==t.sanctuary)&&s.model.autoCalculate&&s.loadDragons()},!0)},s.calculate=function(n,t,i){n&&t&&(s.startRequest(),s.breedingService.calculation(t,n,i).then(function(n){s.result=n}).finally(s.finishRequest))},s.loadDragons=function(){clearTimeout(s.tm);s.tm=setTimeout(function(){s.isLoading=!0;s.model.femaleTypeId=s.model.female.TypeId;s.model.maleTypeId=s.model.male.TypeId;s.startRequest();s.breedingService.calculate(s.model).then(function(n){return s.model.result=n}).finally(s.finishRequest);s.$scope.$apply()},100)},s.selectMaleClick=function(){s.openSlide();s.model.selectMode="m"},s.selectFemaleClick=function(){s.openSlide();s.model.selectMode="f"},s.openSlide=function(){s.mainSlide.isOpen=!0;s.mainSlide.size="80%";s.mainSlide.title="Select Dragons";s.$location.path("/Breeding/SelectDragons")},s.getImage=function(n){return""+s.dragonFactoryService.imgUrl+n+"_3.png"},s.calculateClick=function(){s.loadDragons()},s.init(),s}return __extends(t,n),t.$inject=["$scope","$routeParams","$location","$timeout","breedingService","progressBarService","dragonFactoryService"],t}(n);app.controller("breedingCalculationCtrl",t)})(t=n.BreedingCalculation||(n.BreedingCalculation={}))})(App||(App={}));
var Shared;(function(n){var t;(function(){var n=function(){function n(){this.restrict="A";this.require="ngModel";this.link=function(n,t){n.$watchCollection(function(){return n.dropdownBounceModel},function(n,i){n.length!==i.length&&($(t).hide("normal"),$(t).show("normal"))})};this.scope={dropdownBounceModel:"="}}return n}();app.directive("dropdownBounce",AngularExtensions.createDirectiveFactory(n))})(t=n.Component||(n.Component={}))})(Shared||(Shared={}));
var Shared;(function(n){var i=function(){function n(){}return n.reloadHabitat="reloadHabitats",n.tabClick="tabClick",n.tabActive="tabActive",n.userInfoLoaded="userInfoLoaded",n.refreshUserInfo="refreshUserInfo",n.onSelectedCrystal="selectedCrystal",n.onTournamentFight="onTournamentFight",n.moveDragonToDragonarium="moveDragonToDragonarium",n.updateDragonarium="updateDragonarium",n.habitatClick="habitatClick",n.deleteDragon="deleteDragon",n.saveTeamCombat="saveTeamCombat",n.saveArenaAttackTeam="saveArenaAttackTeam",n.saveArenaDefenseTeam="saveArenaDefenseTeam",n.saveDragonTrainingStar="saveDragonTrainingStar",n.slideOpen="slideOpen",n.arenaLoaded="arenaLoaded",n.refreshAttackCount="refreshAttackCount",n.onHatcheryRefresh="hatcheryRefresh",n}(),t;n.EventName=i;t=function(){function n(){}return n.ironMan="iron-man",n.superMan="super-man",n.hulk="hulk",n.wonderWoman="wonder-woman",n.myStore="my-store",n.myDragon="my-dragons",n.heroic="heroic",n.bot="bot",n.acientWorld="ancient-world",n.premiumPrice="premium-price",n.mazeIsland="maze-island",n.battleground="battleground",n.gridIsland="grid-island",n}();n.TabName=t})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(){var n=function(){function n(n,t){this.dragonFactoryService=n;this.messageService=t;this.restrict="A";this.link=function(n,t){$(t).error(function(n){$(n.currentTarget).attr("src","/Content/Images/no-avatar.jpg")})};this.scope={typeId:"="}}return n.$inject=["dragonFactoryService","messageService"],n}();app.directive("loadDefaultImageIfError",AngularExtensions.createDirectiveFactory(n))})(t=n.Component||(n.Component={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(){var n,t;(function(n){n[n.Egg=0]="Egg";n[n.Teen=1]="Teen";n[n.Adult=2]="Adult";n[n.None=3]="None"})(n||(n={}));t=function(){function t(t,i){var r=this;this.dragonFactoryService=t;this.messageService=i;this.restrict="A";this.link=function(n,t){t.css("cursor","pointer");r.pv=$("#preview");r.showPreview(t,n.typeId)};this.showImage=function(t,i){i.is("button")&&(i=i.parent("div"));r.pv.show();r.pv.css("left",i.position().left+2+i.width()).css("top",i.position().top+200);r.pv.empty();r.pv.html("<span>"+r.messageService.loadingImage+"<span>");var u=window.itemImage[t];u&&u.indexOf("dragons")===0?r.pv.append(r.buildImage(n.Egg,t)).append(r.buildImage(n.Teen,t)).append(r.buildImage(n.Adult,t)):r.pv.append(r.buildImage(n.None,t))};this.showPreview=function(n,t){var i=r;n.on({mouseenter:function(){n.is("select")&&(t=kendo.parseInt(n.find(":selected").attr("type-id")));r.showImage(t,n)},mouseleave:function(){r.pv.hide()}});if($.browser.mozilla)n.find("option").on({mouseenter:function(){i.showImage(t,n)},mouseleave:function(){i.pv.hide()}})};this.buildImage=function(t,i){var f=r.dragonFactoryService.imgUrl,e=window.itemImage[i],u=""+f+e,o=t===n.None?u:u+"_"+t;return $('<img src="'+o+'.png" style="display:none;"/>').load(r.showImageCompleted).error(function(n){r.onError($(n.currentTarget),i)})};this.showImageCompleted=function(){r.pv.find("span").empty();r.pv.find("img").show()};this.onError=function(n,t){if(r.errorCount<3){var i=window.itemImageName[t],u=""+r.dragonFactoryService.imgUrlDesktop+i+".jpg";n.attr("src",u);r.errorCount++}};this.scope={typeId:"="};this.errorCount=0}return t.$inject=["dragonFactoryService","messageService"],t}();app.directive("previewItem",AngularExtensions.createDirectiveFactory(t))})(t=n.Component||(n.Component={}))})(Shared||(Shared={}));
app.directive("timer",["$compile",function(n){return{restrict:"EAC",replace:!1,scope:{interval:"=interval",startTimeAttr:"=startTime",endTimeAttr:"=endTime",countdownattr:"=countdown",finishCallback:"&finishCallback",autoStart:"&autoStart",maxTimeUnit:"="},controller:["$scope","$element","$attrs","$timeout",function(t,i,r,u){function f(){t.timeoutId&&clearTimeout(t.timeoutId)}function e(){r.startTime!==undefined&&(t.millis=new Date-new Date(t.startTimeAttr));t.maxTimeUnit&&t.maxTimeUnit!=="day"?t.maxTimeUnit==="second"?(t.seconds=Math.floor(t.millis/1e3),t.minutes=0,t.hours=0,t.days=0,t.months=0,t.years=0):t.maxTimeUnit==="minute"?(t.seconds=Math.floor(t.millis/1e3%60),t.minutes=Math.floor(t.millis/6e4),t.hours=0,t.days=0,t.months=0,t.years=0):t.maxTimeUnit==="hour"?(t.seconds=Math.floor(t.millis/1e3%60),t.minutes=Math.floor(t.millis/6e4%60),t.hours=Math.floor(t.millis/36e5),t.days=0,t.months=0,t.years=0):t.maxTimeUnit==="month"?(t.seconds=Math.floor(t.millis/1e3%60),t.minutes=Math.floor(t.millis/6e4%60),t.hours=Math.floor(t.millis/36e5%24),t.days=Math.floor(t.millis/864e5%30),t.months=Math.floor(t.millis/2592e6),t.years=0):t.maxTimeUnit==="year"&&(t.seconds=Math.floor(t.millis/1e3%60),t.minutes=Math.floor(t.millis/6e4%60),t.hours=Math.floor(t.millis/36e5%24),t.days=Math.floor(t.millis/864e5%30),t.months=Math.floor(t.millis/2592e6%12),t.years=Math.floor(t.millis/31536e6)):(t.seconds=Math.floor(t.millis/1e3%60),t.minutes=Math.floor(t.millis/6e4%60),t.hours=Math.floor(t.millis/36e5%24),t.days=Math.floor(t.millis/864e5),t.months=0,t.years=0);t.secondsS=t.seconds===1||t.seconds===0?"":"s";t.minutesS=t.minutes===1||t.minutes===0?"":"s";t.hoursS=t.hours===1||t.hours===0?"":"s";t.daysS=t.days===1||t.days===0?"":"s";t.monthsS=t.months===1||t.months===0?"":"s";t.yearsS=t.years===1||t.years===0?"":"s";t.sseconds=t.seconds<10?"0"+t.seconds:t.seconds;t.mminutes=t.minutes<10?"0"+t.minutes:t.minutes;t.hhours=t.hours<10?"0"+t.hours:t.hours;t.ddays=t.days<10?"0"+t.days:t.days;t.mmonths=t.months<10?"0"+t.months:t.months;t.yyears=t.years<10?"0"+t.years:t.years}typeof String.prototype.trim!="function"&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});t.autoStart=r.autoStart||r.autostart;i.html().trim().length===0?i.append(n("<span>{{millis}}<\/span>")(t)):i.append(n(i.contents())(t));t.startTime=null;t.endTime=null;t.timeoutId=null;t.countdown=t.countdownattr&&parseInt(t.countdownattr,10)>=0?parseInt(t.countdownattr,10):undefined;t.isRunning=!1;t.$on("timer-start",function(){t.start()});t.$on("timer-resume",function(){t.resume()});t.$on("timer-stop",function(){t.stop()});t.$on("timer-clear",function(){t.clear()});t.$on("timer-set-countdown",function(n,i){t.countdown=i});t.start=i[0].start=function(){t.startTime=t.startTimeAttr?new Date(t.startTimeAttr):new Date;t.endTime=t.endTimeAttr?new Date(t.endTimeAttr):null;t.countdown||(t.countdown=t.countdownattr&&parseInt(t.countdownattr,10)>0?parseInt(t.countdownattr,10):undefined);f();o();t.isRunning=!0};t.resume=i[0].resume=function(){f();t.countdownattr&&(t.countdown+=1);t.startTime=new Date-(t.stoppedTime-t.startTime);o();t.isRunning=!0};t.stop=t.pause=i[0].stop=i[0].pause=function(){var n=t.timeoutId;t.clear();t.$emit("timer-stopped",{timeoutId:n,millis:t.millis,seconds:t.seconds,minutes:t.minutes,hours:t.hours,days:t.days})};t.clear=i[0].clear=function(){t.stoppedTime=new Date;f();t.timeoutId=null;t.isRunning=!1};i.bind("$destroy",function(){f();t.isRunning=!1});t.countdownattr?(t.millis=t.countdownattr*1e3,t.addCDSeconds=i[0].addCDSeconds=function(n){t.countdown+=n;t.$digest();t.isRunning||t.start()},t.$on("timer-add-cd-seconds",function(n,i){u(function(){t.addCDSeconds(i)})}),t.$on("timer-set-countdown-seconds",function(n,i){t.isRunning||t.clear();t.countdown=i;t.millis=i*1e3;e()})):t.millis=0;e();var o=function(){t.millis=new Date-t.startTime;var n=t.millis%1e3;if(t.endTimeAttr&&(t.millis=t.endTime-new Date,n=t.interval-t.millis%1e3),t.countdownattr&&(t.millis=t.countdown*1e3),t.millis<0){t.stop();t.millis=0;e();t.finishCallback&&t.$eval(t.finishCallback);return}e();t.timeoutId=setTimeout(function(){o();t.$digest()},t.interval-n);t.$emit("timer-tick",{timeoutId:t.timeoutId,millis:t.millis});t.countdown>0?t.countdown--:t.countdown<=0&&(t.stop(),t.finishCallback&&t.$eval(t.finishCallback))};(t.autoStart===undefined||t.autoStart===!0)&&t.start()}]}}]);
var Shared;(function(n){var t;(function(){var n=function(){function n(){this.restrict="A";this.link=function(n,t){$(t).hover(function(){$(t).tooltip("show")},function(){$(t).tooltip("hide")})}}return n}();app.directive("tooltip",AngularExtensions.createDirectiveFactory(n))})(t=n.Directive||(n.Directive={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(){var n=function(){function n(n,t){var i=this;this.$scope=n;this.$element=t;this.$onInit=function(){if(!i.buttons||!i.buttons.length){var n={title:"OK",onClick:i.onOk},t={title:"Cancel",onClick:i.onCancel};i.buttons=[n,t]}};this.$postLink=function(){};this.onClick=function(n){n.onClick&&n.onClick(i.model)}}return n.$inject=["$scope","$element"],n}();app.component("confirmation",{controller:n,templateUrl:"/Scripts/App/Common/Components/confirmation.partial.html",bindings:{buttons:"=?",isVisible:"=",onOk:"=?",onCancel:"=?",message:"@?"},controllerAs:"vm"})})(t=n.Component||(n.Component={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(){var n=function(){function n(n,t,i){var r=this;this.$scope=n;this.$timeInterval=t;this.countDownService=i;this.$onInit=function(){r.originalTotalSecond=r.totalSeconds;r.originalTotalSecond>0&&r.$scope.$watch("vm.isStart",function(){r.isStart=="true"||r.isStart==!0?(r.$timeInterval.cancel(r.counter),r.totalSeconds=r.originalTotalSecond,r.counter=r.$timeInterval(r.countDown,1e3)):r.$timeInterval.cancel(r.counter)});r.$scope.$on("$destroy",function(){r.$timeInterval.cancel(r.counter)})};this.countDown=function(){if(r.itemId&&r.countDownService.setCachedCountDown(r.itemId,r.totalSeconds),r.totalSeconds=r.totalSeconds-1,r.totalSeconds<0){r.isStart=0;r.onStop&&r.onStop();return}var t=r.totalSeconds%60,n=Math.floor(r.totalSeconds/60),i=Math.floor(n/60);n%=60;i%=60;r.timeLeft=r.showSecondOnly?""+r.format(t):r.format(i)+":"+r.format(n)+":"+r.format(t);r.onTicks&&r.onTicks(r.timeLeft)};this.format=function(n){return kendo.toString(n,"00")}}return n.$inject=["$scope","$interval","countDownService"],n}();app.component("countDown",{template:'<span class="count-down">{{vm.timeLeft}}<\/span>',controller:n,controllerAs:"vm",bindings:{totalSeconds:"<",itemId:"<",onStop:"=",isStart:"=",onTicks:"=",showSecondOnly:"="}})})(t=n.Component||(n.Component={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(){var n=function(){function n(){this.restrict="E";this.link=function(){};this.template=function(){return'\n                <div class="spinner-overlay"><\/div>\n                <div class="cssload-loader">\n\t            <div class="cssload-side"><\/div>\n\t            <div class="cssload-side"><\/div>\n\t            <div class="cssload-side"><\/div>\n\t            <div class="cssload-side"><\/div>\n\t            <div class="cssload-side"><\/div>\n\t            <div class="cssload-side"><\/div>\n\t            <div class="cssload-side"><\/div>\n\t            <div class="cssload-side"><\/div>\n            <\/div>'}}return n}();app.directive("spinnerLoading",AngularExtensions.createDirectiveFactory(n))})(t=n.Directive||(n.Directive={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(){var n=function(){function n(){this.restrict="A";this.link=function(n,t,i){var r=$(i.slideToggle);i.expanded=!1;t.bind("click",function(){var n=$(".slideable_content"),t;i.expanded?r.height(0):(n.css("border","1px solid rgba(0,0,0,0)"),t=n[0].clientHeight,n.css("border",0),r.height(t));i.expanded=!i.expanded})};this.template=function(){return""}}return n}();app.directive("slideToggle",AngularExtensions.createDirectiveFactory(n))})(t=n.Directive||(n.Directive={}))})(Shared||(Shared={}));angular.module("angularSlideables",[]).directive("slideable",function(){return{restrict:"C",compile:function(n){var t=n.html();return n.html('<div class="slideable_content" style="margin:0 !important; padding:0 !important" >'+t+"<\/div>"),function(n,t,i){i.duration=i.duration?i.duration:"1s";i.easing=i.easing?i.easing:"ease-in-out";t.css({overflow:"hidden",height:"0px",transitionProperty:"height",transitionDuration:i.duration,transitionTimingFunction:i.easing})}}}}).directive("slideToggle",function(){return{restrict:"A",link:function(n,t,i){var r=document.querySelector(i.slideToggle);i.expanded=!1;t.bind("click",function(){var n=r.querySelector(".slideable_content"),t;i.expanded?r.style.height="0px":(n.style.border="1px solid rgba(0,0,0,0)",t=n.clientHeight,n.style.border=0,r.style.height=t+"px");i.expanded=!i.expanded})}}});
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Shared;(function(n){var t;(function(){var t=n.PageBaseController,i=function(n){function t(t,i,r,u){var f=n.call(this,t,r)||this;return f.$scope=t,f.dragonFactoryService=i,f.progressBarService=r,f.messageService=u,f.showConfirm=!1,f.$onInit=function(){f.startRequest();f.dragonFactoryService.getAllSkills().then(function(n){f.allSkills=n;f.isLoading=!1;f.showConfirm=!1}).finally(f.finishRequest);f.messageSkill=f.messageService.messageSkill},f.getAttackSkillTooltip=function(n){return window.attackSkill[n]},f.skillClick=function(n){f.selectedTargetSkill=n},f.onOkClick=function(){},f.onCancelClick=function(){f.showConfirm=!1;f.onCancel&&f.onCancel()},f.getImageSrc=function(n){return f.dragonFactoryService.getImageUrl(n)},f.getSkillImageSrc=function(n){return"https://dragoncityguide.net/images/attacks/"+(n.Element+".png")},f}return __extends(t,n),t.$inject=["$scope","dragonFactoryService","progressBarService","messageService"],t}(t);app.component("attackSkill",{templateUrl:"/Scripts/App/Common/Components/AttackSkill/attackSkill.partial.html",controller:i,controllerAs:"vm",bindings:{dragon:"=",selectedSkillIndex:"=",selectedTargetSkill:"=",onOk:"=",onCancel:"="}})})(t=n.Component||(n.Component={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(){var n=function(){function n(){this.getAttackSkillTooltip=function(n){return window.attackSkill[n]};this.getSkillImageSrc=function(n){return"https://dragoncityguide.net/images/attacks/"+(n.Element+".png")};this.$onInit=function(){}}return n}();app.component("iconSkill",{template:'<img class="main-skill" title="{{vm.getAttackSkillTooltip(vm.model.Id)}}"\n                            ng-src="{{vm.getSkillImageSrc(vm.model)}}" />\n                        <img title="{{vm.getAttackSkillTooltip(vm.model.Id)}}"\n                            ng-if="vm.model.IsAdvanceSkill" class="advance-skill"\n                            src="https://dragoncityguide.net/images/attacks/attack-highlight.png" />',controller:n,controllerAs:"vm",bindings:{model:"="}})})(t=n.Component||(n.Component={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(){var n=function(){function n(n){var t=this;this.dragonFactoryService=n;this.$onInit=function(){t.dragon.ImageUrl=t.dragonFactoryService.getImageUrl(t.dragon)}}return n.$inject=["dragonFactoryService"],n}();app.component("dragonBox",{templateUrl:"/Scripts/App/Common/Components/DragonBox/dragonBox.partial.html",controller:n,bindings:{dragon:"="},controllerAs:"vm"})})(t=n.Component||(n.Component={}))})(Shared||(Shared={}));
var App;(function(n){var t;(function(){var n=function(){function n(n){var t=this;this.$scope=n;this.ranges={0:0,1:5,2:15,3:35,4:60,5:90,6:120,7:160,8:200,9:250};this.$onInit=function(){t.starts=t.getStar();t.color=t.getColor()};this.getStar=function(){var n,i;if(t.kill<5)return"";for(n=_.keys(t.ranges).length;n>0;n--)if(t.kill>t.ranges[n])return i=n%3,i===1?"one":i===2?"two":"three";return""};this.getColor=function(){return t.kill>160?"gold":t.kill>60?"silver":"bronze"};this.$scope.$watch("vm.kill",function(n,i){n!==i&&t.$onInit()})}return n.$inject=["$scope"],n}();app.component("dragonStar",{templateUrl:"/Scripts/App/Common/Components/DragonStar/dragonStart.partial.html",controller:n,controllerAs:"vm",bindings:{kill:"@"}})})(t=n.Component||(n.Component={}))})(App||(App={}));
var Shared;(function(n){var t;(function(){var n=function(){function n(n,t,i,r){var u=this;this.$scope=n;this.dragonFactoryService=t;this.progressBarService=i;this.habitatFactoryService=r;this.$onInit=function(){u.elements=window.dragonAttributes};this.rarityClick=function(n){u.hasElement(n)?u.selectedElements=_.filter(u.selectedElements,function(t){return t!==n}):u.selectedElements.push(n);u.onSelected&&u.onSelected(u.selectedElements)};this.hasElement=function(n){return _.any(u.selectedElements,function(t){return t===n})};this.selectedElements=[]}return n.$inject=["$scope","dragonFactoryService","progressBarService","habitatFactoryService"],n}();app.component("elementSelector",{templateUrl:"/Scripts/App/Common/Components/ElementSelector/elementSelector.partial.html",controller:n,bindings:{onSelected:"="},controllerAs:"vm"})})(t=n.Component||(n.Component={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(){var n=function(){function n(){var n=this;this.$onInit=function(){n.availableLevel=[];for(var t=n.min;t<n.max+1;t++)n.availableLevel.push(t);n.selectedLevel=n.min};this.onOkClick=function(){n.onOk&&n.onOk(n.selectedLevel)};this.onCancelClick=function(){n.onCancel&&n.onCancel()}}return n}();app.component("feedDragon",{template:'<div>\n                        <p>Current Level: {{vm.min}}<\/p>\n                        <p>Level: <select class="form-control" ng-model="vm.selectedLevel" \n                                ng-options="i as i for i in vm.availableLevel">\n                        <\/select><\/p>\n                        <button ng-click="vm.onOkClick()" class="btn btn-primary">FEED ME<\/button>\n                        <button ng-click="vm.onCancelClick()" class="btn btn-default">Cancel<\/button>\n                        <\/div>',bindings:{min:"=",max:"=",onOk:"=",onCancel:"="},controller:n,controllerAs:"vm"})})(t=n.Component||(n.Component={}))})(Shared||(Shared={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Shared;(function(n){var t;(function(){var t=n.PageBaseController,i=function(t){function i(i,r,u,f){var e=t.call(this,i,u)||this;return e.$scope=i,e.dragonFactoryService=r,e.progressBarService=u,e.habitatFactoryService=f,e.$onInit=function(){e.initHabitatas();e.$scope.$on(n.EventName.reloadHabitat,function(){e.initHabitatas()})},e.initHabitatas=function(){e.startRequest();e.habitatFactoryService.getHabitat().then(function(n){e.habitats=n;e.buildImage()}).finally(e.finishRequest)},e.onSelectHabitat=function(n){e.onClick&&e.onClick(n,e.habitats)},e.buildImage=function(){_.each(e.habitats,function(n){n.ImageUrl=e.dragonFactoryService.getImageUrl(n);_.each(n.dragons,function(n){n.ImageUrl=e.dragonFactoryService.getImageUrl(n)})})},e}return __extends(i,t),i.$inject=["$scope","dragonFactoryService","progressBarService","habitatFactoryService"],i}(t);app.component("habitats",{templateUrl:"/Scripts/App/Common/Components/Habitats/habitat.partial.html",controller:i,bindings:{onClick:"=",selectedDragon:"="},controllerAs:"vm"})})(t=n.Component||(n.Component={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(){var n=function(){function n(n,t,i,r){var u=this;this.$scope=n;this.dragonFactoryService=t;this.progressBarService=i;this.habitatFactoryService=r;this.$onInit=function(){u.rarities=["X","C","R","V","E","L","H"];u.selectedRarity=[]};this.hasElement=function(n){return _.any(u.selectedRarity,function(t){return t===n})};this.rarityClick=function(n){n=="X"?u.selectedRarity=[]:u.hasElement(n)?u.selectedRarity=_.filter(u.selectedRarity,function(t){return t!==n}):u.selectedRarity.push(n);u.onRaritySelected&&u.onRaritySelected(u.selectedRarity)}}return n.$inject=["$scope","dragonFactoryService","progressBarService","habitatFactoryService"],n}();app.component("raritySelector",{templateUrl:"/Scripts/App/Common/Components/RaritySelector/raritySelector.partial.html",controller:n,bindings:{onRaritySelected:"="},controllerAs:"vm"})})(t=n.Component||(n.Component={}))})(Shared||(Shared={}));
var Store;(function(n){var t;(function(){var n=function(){function n(n,t,i,r){var u=this;this.$scope=n;this.progressBarService=t;this.userStoreService=i;this.messageService=r;this.$onInit=function(){u.model={ResourceType:u.resourceType==="c"?0:1}};this.isValidAmount=function(){return u.model&&u.model.Amount?u.model.Amount%50==0:!0};this.sendResourceClick=function(){confirm("Are you sure. You want to send "+u.model.Amount+" "+(u.resourceType==="c"?"gems":"food")+" to FacebookId: "+u.model.ToFacebookId+"\n                .You CAN NOT RECOVER your gems after sent succesfully")&&(u.progressBarService.start(),u.isLoading=!0,u.userStoreService.sendResource(u.model).then(function(n){n.success&&(u.messageService.showMessage("Resource has been sent successfully"),u.onCompleted&&u.onCompleted(n))}).finally(function(){u.progressBarService.complete();u.isLoading=!1}))}}return n.$inject=["$scope","progressBarService","userStoreService","messageService"],n}();app.component("sendingResource",{templateUrl:"/Scripts/App/Common/Components/SendingResource/sendingResource.partial.html",controller:n,bindings:{onCompleted:"=",resourceType:"@"},controllerAs:"vm"})})(t=n.Ui||(n.Ui={}))})(Store||(Store={}));
var Shared;(function(n){var t;(function(){var n,t;(function(n){n[n.Egg=0]="Egg";n[n.Teen=1]="Teen";n[n.Adult=2]="Adult";n[n.None=3]="None"})(n||(n={}));t=function(){function t(t,i){var r=this;this.dragonFactoryService=t;this.messageService=i;this.restrict="A";this.link=function(n,t){t.css("cursor","pointer");r.pv=$("#preview");r.showPreview(t,n.typeId)};this.showImage=function(t,i){i.is("button")&&(i=i.parent("div"));r.pv.show();r.pv.css("left",i.position().left+2+i.width()).css("top",i.position().top+200);r.pv.empty();r.pv.html("<span>"+r.messageService.loadingImage+"<span>");var u=window.itemImage[t];u&&u.indexOf("dragons")===0?r.pv.append(r.buildImage(n.Egg,t)).append(r.buildImage(n.Teen,t)).append(r.buildImage(n.Adult,t)):r.pv.append(r.buildImage(n.None,t))};this.showPreview=function(n,t){var i=r;n.on({mouseenter:function(){n.is("select")&&(t=kendo.parseInt(n.find(":selected").attr("type-id")));r.showImage(t,n)},mouseleave:function(){r.pv.hide()}});if($.browser.mozilla)n.find("option").on({mouseenter:function(){i.showImage(t,n)},mouseleave:function(){i.pv.hide()}})};this.buildImage=function(t,i){var f=r.dragonFactoryService.imgUrl,e=window.itemImage[i],u=""+f+e,o=t===n.None?u:u+"_"+t;return $('<img src="'+o+'.png" style="display:none;"/>').load(r.showImageCompleted).error(function(n){r.onError($(n.currentTarget),i)})};this.showImageCompleted=function(){r.pv.find("span").empty();r.pv.find("img").show()};this.onError=function(n,t){if(r.errorCount<3){var i=window.itemImageName[t],u=""+r.dragonFactoryService.imgUrlDesktop+i+".jpg";n.attr("src",u);r.errorCount++}};this.scope={typeId:"="};this.errorCount=0}return t.$inject=["dragonFactoryService","messageService"],t}();app.directive("reward",AngularExtensions.createDirectiveFactory(t))})(t=n.Component||(n.Component={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(){var n=function(){function n(n,t){var i=this;this.$q=n;this.$rootScope=t;this.request=function(n){return i.$rootScope.pendingRequests++,n||i.$q.when(n)};this.requestError=function(n){return i.$rootScope.pendingRequests--,i.$q.reject(n)};this.response=function(n){if(n&&n.data){var t=n.data;typeof t=="object"&&t.hasOwnProperty("success")&&!t.success&&i.showPopup(t.message,t.timeout)}return i.$rootScope.pendingRequests--,n||i.$q.when(n)};this.responseError=function(n){return i.$rootScope.pendingRequests--,n.status===500&&i.showPopup("There are some errors. Try again."),i.$q.reject(n)};this.showPopup=function(n,t){t===void 0&&(t=4e3);utility.showMessage(n,t)}}return n.$inject=["$q","$rootScope"],n}();app.service("ajaxStatusInterceptor",n)})(t=n.Model||(n.Model={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n){var t=this;this.$http=n;this.getBattleground=function(){return t.$http.post("/Battleground/Get",null).then(function(n){return n.data})};this.fight=function(n){return t.$http.post("/Battleground/Fight",{nodeId:n}).then(function(n){return n.data})};this.getExhaustedDragon=function(n){return t.$http.post("/Battleground/GetExhaustedDragons",{trackId:n}).then(function(n){return n.data})};this.resetDragonExhausted=function(n){return t.$http.post("/Battleground/ResetExhaustedDragons",{trackId:n}).then(function(n){return n.data})}}return n.$inject=["$http"],n}();n.BattlegroundService=t;app.service("battlegroundService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(){var n=this;this.countDownCached={};this.setCachedCountDown=function(t,i){n.countDownCached[t]=i};this.getCachedCountDown=function(t){return n.countDownCached[t]}}return n}();n.CountDownService=t;app.service("countDownService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n,t){var i=this;this.$http=n;this.$q=t;this.getCrystals=function(){var n=i.$q.defer();return i.crystals?(n.resolve(i.crystals),n.promise):i.$http.post("/DeityWorld/Getcrystal",null).then(function(n){return i.crystals=n.data,i.crystals})};this.craft=function(n,t){return i.$http.post("/DeityWorld/Craft",{crystalId:n,total:t}).then(function(n){return n.data})};this.collectPlatinumHabitat=function(){return i.$http.post("/DeityWorld/CollectPlatinum",null).then(function(n){return n.data})}}return n.$inject=["$http","$q"],n}();n.DeityWorldService=t;app.service("deityWorldService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n){this.$http=n;this.imgUrl="http://dci-static-s1.socialpointgames.com/static/dragoncity/mobile/ui/";this.getHabitat=function(){};this.moveDragonToHabitat=function(){}}return n}();t.$inject=["$http"];n.HabitatFactoryService=t;app.service("habitatFactoryService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n,t){var i=this,r;this.$http=n;this.$q=t;this.rootUrl=window.rootUrl;this.imgUrl=window.imgUrl;this.imgUrlDesktop=window.imgUrlDesktop;this.getDragonsOnMap=function(n,t,r){n===void 0&&(n=!1);var u=i.$q.defer();return n&&i.dragonsOnMap?u.resolve(i.dragonsOnMap):i.$http.post("/Dragon/GetDragonOnMap",{dragonName:t,rarity:r}).then(function(n){i.dragonsOnMap=n.data;i.bindImageUrl();u.resolve(i.dragonsOnMap)}),u.promise};this.bindImageUrl=function(){_.each(i.dragonsOnMap,function(n){var t=window.itemImage[n.Type||n.TypeId];t&&(n.imageUrl=i.getImageFromType(n.Type||n.TypeId),n.thumbUrl=i.getImageThumbFromType(n.Type||n.TypeId))})};this.getImageFromType=function(n){var t=window.itemImage[n];return t?i.imgUrl+t+"_3.png":null};this.getImageThumbFromType=function(n){var t=window.itemImage[n];return t?i.imgUrl+t.replace(/dragons\/ui/g,"dragons/HD/thumb")+"_3.png":null};this.getRarities=function(){return["X","C","R","V","E","L","H"]};this.getImageFromElementName=function(n){var t=i.getElementName(n);return"/Content/Images/DragonType/ic-"+t+"-flag.png"};this.getElementName=function(n){return{w:"water",p:"plant",f:"fire",d:"dark",e:"earth",el:"electric",m:"metal",i:"ice",wr:"war",l:"legend",li:"light",pu:"pure",bt:"beauty",ch:"chaos",mg:"magic",hp:"happiness",dr:"dream",so:"soul",pr:"primal"}[n]};this.getHabitat=function(){return i.$http.post("/Home/GetHabitat",null).then(function(n){return n.data})};this.updateName=function(n){return i.$http.post("/Dragon/UpdateName",{dragonId:n.Id,name:n.CustomName})};this.moveDragonToHabitat=function(n,t){return i.$http.post("/Dragon/MoveDragonToHabitat",{dragonId:n,habitatId:t}).then(function(n){return n.data})};this.moveDragonToDragonarium=function(n){return i.$http.post("/Dragon/MoveDragonToDragonarium",{dragonId:n}).then(function(n){return n.data})};this.deleteDragon=function(n,t){return i.$http.post("/Dragon/DeleteDragon",{dragonId:n,isEmptySlot:t}).then(function(n){return n.data})};this.getDragonFromDragonarium=function(n,t,r){return i.$http.post("/Dragon/GetDragonFromDragonarium",{slot:n,habitatId:r,selectedDragon:t}).then(function(n){return n.data})};this.getImageUrl=function(n){var t=n.GroupType||n.groupType,r=n.Image||n.image;return t?t.toLowerCase()==="habitat"||t.toLowerCase()==="kindergarten"?i.imgUrl+r+".png":i.imgUrl+r+"_3.png":""};this.feedDragon=function(n,t,r){return i.$http.post("/Dragon/Feed",{dragonId:n,currentLevel:t,expectedLevel:r}).then(function(n){return n.data})};this.sellDragon=function(n){return i.$http.post("/Dragon/Sell",{dragonId:n}).then(function(n){return n.data})};this.storeDragon=function(n){return i.$http.post("/Dragon/Store",{dragonId:n}).then(function(n){return n.data})};this.getAllSkills=function(){var n=i.$q.defer();return i.allSkills?(n.resolve(i.allSkills),n.promise):i.$http.post("/Dragon/GetAllSkills",null).then(function(n){return i.allSkills=n.data,i.allSkills})};this.learnSkill=function(n,t,r){return i.$http.post("/Dragon/LearnSkill",{dragonId:n,slotIndex:t,skillId:r}).then(function(n){return n.data})};this.getMyDragonBack=function(n){return i.$http.post("/Dragon/GetMyDragonBack",{dragonId:n.Id,workingId:n.WorkId}).then(function(n){return n.data})};this.getMyDragonFromBreeding=function(n){return i.$http.post("/Dragon/GetMyDragonBackFromBreeding",{workId:n}).then(function(n){return n.data})};this.storeAndMoveAllDragonsToHabitat=function(){return i.$http.post("/Dragon/StoredAndMoveAllDragons",null).then(function(n){return n.data})};this.updateDragonKillLocal=function(n,t){if(i.dragonsOnMap){var r=_.filter(i.dragonsOnMap,function(t){return t.Id===n});r[0].Kill=t}};this.updateDragonKill=function(n,t){for(var r=_.reduce(n,function(n,t){return n[t]=0,n},{}),u=0;u<t;u++)n.length===3?_.each(n,function(n){return r[n]+=1}):n.length===2?(r[n[0]]+=2,r[n[1]]+=1):n.length===1&&(r[n[0]]+=3);return i.dragonsOnMap&&_.each(i.dragonsOnMap,function(n){r[n.Id]&&(n.Kill+=r[n.Id])}),r};r=this.rootUrl+"/assets/images/en/tree_of_life/seeds/small/ic-seed-h.png?version=1"}return n.$inject=["$http","$q"],n}();n.DragonFactoryService=t;app.service("dragonFactoryService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n){var t=this;this.$http=n;this.getEvent=function(){return t.$http.post("/GridIsland/Get",null).then(function(n){return n.data})};this.collectItem=function(n){return t.$http.post("/GridIsland/CollectItem",n).then(function(n){return n.data})}}return n.$inject=["$http"],n}();n.GridIslandService=t;app.service("gridIslandService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n){var t=this;this.$http=n;this.imgUrl="http://dci-static-s1.socialpointgames.com/static/dragoncity/mobile/ui/";this.getHabitat=function(){return t.$http.post("/Habitat/GetAll",null).then(function(n){return n.data})}}return n.$inject=["$http"],n}();n.HabitatFactoryService=t;app.service("habitatFactoryService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n,t,i){var r=this;this.$http=n;this.userInfoContext=t;this.$window=i;this.castSpell=function(n,t,i){return r.$http.post("/Home/CastSpell",{mageId:n,buildingId:t,itemId:i}).then(function(n){return n.data})};this.rebindEggOnHatchery=function(){window.getItemOnHatchery(r.userInfoContext.userConfig.itemOnHatchery);window.animation($(r.$window.dropDownList.Hatchery))};this.rebindBreedingResult=function(){window.bindBreedingBuilding();$(r.$window.dropDownList.BreedingResult).change();window.animation($(r.$window.dropDownList.BreedingResult))};this.breedingSpeedUp=function(n){return r.$http.post("/Home/VideoBreedingSpeedUp",{itemId:n}).then(function(n){return n.data})};this.collectSpeedUp=function(n){return r.$http.post("/Home/VideoCollectSpeedUpAndCollect",{itemId:n}).then(function(n){return n.data})};this.hatchingSpeedUp=function(n){return r.$http.post("/Home/VideoHatchingSpeedUp",{itemId:n}).then(function(n){return n.data})};this.upgradeItem=function(n){return r.$http.post("/Home/UpgradeItem",{itemId:n}).then(function(n){return n.data})};this.randomAllDragonsName=function(){return r.$http.post("/Dragon/randomAllDragonsName",null).then(function(n){return n.data})}}return n.$inject=["$http","userInfoContext","$window"],n}();n.IronManService=t;app.service("ironManService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n){var t=this;this.$http=n;this.getEvent=function(){return t.$http.post("/MazeIsland/Get",null).then(function(n){return n.data})};this.collectItem=function(n){return t.$http.post("/MazeIsland/CollectItem",n).then(function(n){return n.data})}}return n.$inject=["$http"],n}();n.MazeIslandService=t;app.service("mazeIslandService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(){this.resource=window.resources;this.showMessage=function(n,t){t===void 0&&(t=4e3);utility.showMessage(n,t)};this.warningTransfer=this.resource.WarningAutoTransfer;this.beginTransfer=this.resource.BeginTransfer;this.autoTransfer=this.resource.AutoTransfer;this.areYouSure=this.resource.AreYouSure;this.total=this.resource.Total;this.stop=this.resource.Stop;this.second=this.resource.Second;this.wating=this.resource.Waiting;this.confirmSwitchToPremiumServer=this.resource.ConfirmSwitchToPremiumServer;this.starting=this.resource.Starting;this.transfering=this.resource.Transfering;this.messageSkill=this.resource.Left+": "+this.resource.OldSkill+" - "+this.resource.Right+": "+this.resource.NewSkill;this.dragonIsWorking=this.resource.DragonIsWorking;this.noDragonMatchRequirement=this.resource.NoDragonMatchRequirement;this.numberDragonMatchRequirement=this.resource.NumberDragonMatchRequirement;this.setAttackTeam=this.resource.SetAttackTeam;this.no=this.resource.No;this.buyAnyItem=this.resource.BuyAnyItem;this.allTournamentsCup=this.resource.AllTournamentsCup;this.breedingResult=this.resource.BreedingResult;this.setDefenseTeam=this.resource.SetDefenseTeam;this.addKill=this.resource.AddKill;this.storeDragonWarning=this.resource.StoreDragonWarning;this.loadingImage=this.resource.LoadingImage;this.male=this.resource.Male;this.female=this.resource.Female;this.breedingCount=this.resource.BreedingCount;this.resource=window.resources}return n}();n.MessageService=t;app.service("messageService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n){var t=this;this.$http=n;this.getOffers=function(){return t.$http.post("/Buy/GetOfferDragons",null).then(function(n){return n.data})};this.buyOffer=function(n){return t.$http.post("/Buy/BuyOfferDragon",{id:n}).then(function(n){return n.data})}}return n.$inject=["$http"],n}();n.OfferDragonsService=t;app.service("offerDragonsService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n){this.$q=n;this.closePopup=function(){window.setTimeout(function(){window.closePopup()},100)};this.centerPopup=function(n,t){var i=$(".modal").parent(),r=i.parent();i.css({top:t||($(r).height()-i.outerHeight())/2+$(r).scrollTop()+"px",left:n||($(r).width()-i.outerWidth())/2+$(r).scrollLeft()+"px"})}}return n.prototype.showPopup=function(n,t,i,r){n===void 0&&(n="");t===void 0&&(t=600);i===void 0&&(i=1e3);r===void 0&&(r=0);var u=this.$q.defer();return window.openPopup(n,"",i,t,null,"set-attack-team",function(){var n=$(this);n.empty();u.resolve(n)}),r!==0&&this.centerPopup(null,r),u.promise},n.$inject=["$q"],n}();n.PopupService=t;app.service("popupService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n,t){var i=this;this.ngProgressFactory=n;this.$interval=t;this.set=function(n){i.progressbar.start();i.progressbar.set(n);n===100&&(i.$interval.cancel(i.interval),i.progressbar.complete())};this.start=function(n){n===void 0&&(n=70);i.isLoading=!0;i.$interval.cancel(i.interval);i.progressbar.start();n&&(i.interval=i.$interval(function(){i.progressbar.status()>=n&&(i.progressbar.stop(),i.$interval.cancel(i.interval))},100))};this.complete=function(){i.progressbar.complete();i.isLoading=!1};this.progressbar=this.ngProgressFactory.createInstance()}return n.$inject=["ngProgressFactory","$interval"],n}();n.ProgressBarService=t;app.service("progressBarService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n){var t=this;this.$q=n;this.getConnectionId=function(){return $.connection.hub.id};this.hubStart=function(){return t.registerProgressHub(),$.connection.hub.start().done(function(){return $.connection.hub.id})};this.registerProgressHub=function(){t.mainHub=$.connection.mainProgressHub;t.mainHub.client.addProgress=function(n,i){t.onProgressChanged(i)};t.mainHub.client.writeLog=function(n){t.onLogEvent(n)}};this.registerProgressHub()}return n.$inject=["$q"],n}();n.ProgressHubService=t;app.service("progressHubService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n){var t=this;this.$http=n;this.getItemNeedStore=function(n){return t.$http.post("/RescureDragon/GetItemNeedStore",{dragonId:n}).then(function(n){return n.data})}}return n.$inject=["$http"],n}();n.RescureDragonService=t;app.service("rescureDragonService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n){var t=this;this.$http=n;this.inviteFriendMarket=function(){return t.$http.post("/Social/InviteFriendMarket",null).then(function(n){return n.data})};this.getFood=function(){return t.$http.post("/Social/GetFood",null).then(function(n){return n.data})};this.sendFoodAsGift=function(){return t.$http.post("/Social/SendFoodAsGift",null).then(function(n){return n.data})};this.inviteSocialBuilding=function(n){return t.$http.post("/Social/InviteSocialBuilding",{buildingId:n}).then(function(n){return n.data})};this.openChest=function(n,i){return t.$http.post("/Home/OpenChest",{itemId:n,total:i}).then(function(n){return n.data})}}return n.$inject=["$http"],n}();n.SocialService=t;app.service("socialService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n,t){var i=this;this.$http=n;this.$q=t;this.get=function(){return i.$http.post("TreeOfLife/Get",null).then(function(n){return n.data})};this.summon=function(){return i.$http.post("TreeOfLife/Summon",null).then(function(n){return n.data})};this.recall=function(){return i.$http.post("TreeOfLife/Recall",null).then(function(n){return n.data})};this.empPower=function(){return i.$http.post("TreeOfLife/Empower",null).then(function(n){return n.data})}}return n.$inject=["$http","$q"],n}();n.TreeOfLifeService=t;app.service("treeOfLifeService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n){var t=this;this.$http=n;this.saveUserContext=function(n,i,r){t.user=n;var u=n.userInfo;t.user.gold=kendo.parseFloat(u.Gold);t.user.food=kendo.parseFloat(u.Food);t.user.gem=kendo.parseFloat(u.Gems);t.user.platinum=kendo.parseFloat(u.Platinum);t.user.xp=kendo.parseFloat(u.Xp);t.userConfig=n;t.user.facebookId=i;t.user.sessionId=r};this.getUserInfo=function(){return t.$http.post("/Home/GetUserInfo",{fbId:t.user.facebookId,userKey:t.user.sessionId}).then(function(n){return n.data})}}return n.$inject=["$http"],n}();n.UserInfoContext=t;app.service("userInfoContext",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n){var t=this;this.$http=n;this.getSessionIdFromSigned=function(n){return t.$http.post("/UserSession/GetSessionId",{signedRequest:n}).then(function(n){return n.data})}}return n.$inject=["$http"],n}();n.UserSessionService=t;app.service("userSessionService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n){var t=this;this.$http=n;this.claimReward=function(){return t.$http.post("/UserResource/ClaimReward",null).then(function(n){return n.data})};this.getGems=function(){return t.$http.post("/TabOther/GetGems",null).then(function(n){return n.data})};this.getUserResource=function(){return t.$http.post("/UserResource/GetResource",null).then(function(n){return n.data})};this.getGemsAndOrbs=function(){return t.$http.post("/TabOther/GetGemsAndOrbs",null).then(function(n){return n.data})};this.sendResource=function(n){return t.$http.post("/UserResource/SendResource",n).then(function(n){return n.data})};this.collectPuzzleItems=function(){return t.$http.post("/PuzzleIsland/CollectItem",null).then(function(n){return n.data})};this.claimPuzzleReward=function(){return t.$http.post("/PuzzleIsland/ClaimReward",null).then(function(n){return n.data})};this.collectAndClaimPuzzleIsland=function(){return t.$http.post("/PuzzleIsland/CollectAndClaim",null).then(function(n){return n.data})};this.buyExp=function(){return t.$http.post("/TabOther/BuyExp",null).then(function(n){return n.data})};this.loadDragonFree=function(){return t.$http.post("/TabOther/GetFreeDragons",null).then(function(n){return n.data})};this.claimDragon=function(n){return t.$http.post("/TabOther/ClaimDragon",{dragon:n}).then(function(n){return n.data})};this.getSpecialPrice=function(){return t.$http.post("/TabOther/GetSpecialPrice",null).then(function(n){return n.data})};this.buyWithSpecialPrice=function(n){return t.$http.post("/TabOther/buyWithSpecialPrice",{priceId:n}).then(function(n){return n.data})}}return n.$inject=["$http"],n}();n.UserStoreService=t;app.service("userStoreService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(n){var t;(function(){var n=Shared.PageBaseController,t=function(n){function t(t,i,r,u){var f=n.call(this,t,u)||this;return f.$scope=t,f.$rootScope=i,f.dragonFactoryService=r,f.progressBarService=u,f.$onInit=function(){},f.onHabitatClick=function(n){f.startRequest();var t=f.mainSlide.params;f.dragonFactoryService.getDragonFromDragonarium(t.slot,t.selectedDragon,n.id).then(function(n){n.success&&f.$rootScope.$broadcast(Shared.EventName.updateDragonarium)}).finally(f.finishRequest);f.mainSlide.isOpen=!1},t.$watch(function(){return f.mainSlide.isOpen},function(n){f.showHabitats=n}),f}return __extends(t,n),t.$inject=["$scope","$rootScope","dragonFactoryService","progressBarService"],t}(n);app.controller("habitatListCtrl",t)})(t=n.Habitat||(n.Habitat={}))})(App||(App={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(){var n=function(n){function t(t,i,r,u,f){var e=n.call(this,t,r)||this;e.$scope=t;e.$http=i;e.progressBarService=r;e.heroicRaceService=u;e.messageService=f;e.$onInit=function(){};e.init=function(){e.startRequest();e.heroicRaceService.load().then(function(n){_.each(n.lapRewards,function(t){return t.isClaimed=n.claimedLapRewards.indexOf(t.id)>-1});e.model=n;e.isLoading=!1;e.selectedReward=n.lapRewards[0]}).finally(e.finishRequest)};e.claimReward=function(n){e.startRequest();e.heroicRaceService.claimReward(n.id).then(function(t){t.success&&(n.isClaimed=!0,e.refreshUserInfo(t))}).finally(e.finishRequest)};e.isClaimed=function(n){return console.log(n),e.model.claimedLapRewards.indexOf(n)>-1};e.collectionItemClick=function(n){e.startRequest();var i=e.model,t=i.currentLap,u=n?[n]:t.currentNode.missionsData,r=[];_(u).each(function(n){var u={isLandId:i.islandId,lapId:t.id,nodeId:t.currentNode.id,completedPoints:n.completedPoints,missionId:n.id};r.push(u)});e.heroicRaceService.collectItem(e.model.nextRace&&e.model.nextRace.length?e.model.nextRace:r).then(function(n){var i=n,t;i.result&&(t=i.result,e.model.raceProgress=t.allProgress.raceProgress,e.model.nextRace=t.nextRace,e.model.currentMissionPoints=t.missionPoints,e.messageService.showMessage(i.message))}).finally(e.finishRequest)};$(document).on(Shared.TabName.heroic,function(){e.isLoading=!0;e.init();e.isUserLoaded=!0});return e}return __extends(t,n),t.$inject=["$scope","$http","progressBarService","heroicRaceService","messageService"],t}(Shared.PageBaseController);app.controller("heroicRaceCtrl",n)})(App||(App={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n){var t=this;this.$http=n;this.collectItem=function(n){return t.$http.post("/EventIsland/CollectItem",n).then(function(n){return n.data})};this.load=function(){return t.$http.post("/EventIsland/GetHeroicRace",null).then(function(n){return n.data})};this.claimReward=function(n){return t.$http.post("/EventIsland/ClaimReward",{id:n}).then(function(n){return n.data})}}return n.$inject=["$http"],n}();n.HeroicRaceService=t;app.service("heroicRaceService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var App;(function(){var n=function(){function n(){}return n.$inject=["heroic"],n}();app.controller("heroicProgressDetail",n)})(App||(App={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Shared;(function(n){var t;(function(){var t=function(n){function t(t,i,r,u,f,e){var o=n.call(this,t,u)||this;return o.$scope=t,o.$http=i,o.$element=r,o.progressBarService=u,o.dragonFactoryService=f,o.messageService=e,o.$onInit=function(){o.initGird();var n;o.$scope.$watch("vm.searchTerm",function(t,i){i!=t&&(window.clearTimeout(n),n=window.setTimeout(function(){o.filter($.trim(t))},500))})},o.filter=function(n){n!==""?o.grid.dataSource.filter(o.buildFilter(n)):o.grid.dataSource.filter([])},o.buildFilter=function(n){return{logic:"or",filters:[{field:"FatherName",value:n,operator:"contains"},{field:"MotherName",operator:"contains",value:n},{field:"ResultName",value:n,operator:"contains"},]}},o.initGird=function(){kendo.ui.FilterMenu.fn.options.operators.string={contains:"Contains"};var t=o.$element.find("#grid"),i=new kendo.data.DataSource({type:"aspnetmvc-ajax",serverPaging:!0,serverFiltering:!0,serverSorting:!0,serverAggregates:!0,transport:{read:{url:"/Breeding/GetDataSource"}},pageSize:20,schema:{data:"Data",total:"Total",model:{fields:{FatherName:{type:"string"},MotherName:{type:"string"},ResultName:{type:"string"}}}},sort:{field:"Count",dir:"desc"}}),n={cell:{showOperators:!1,minLength:3e3},operators:{string:{contains:"Contains"}}};t.kendoGrid({dataSource:i,navigatable:!0,filterable:{mode:"row",extra:!1},sortable:!0,selectable:!1,columns:[{title:o.messageService.female,field:"FatherName",width:"200px",filterable:n,template:function(n){var t=o.dragonFactoryService.getImageThumbFromType(n.FatherId);return n.FatherName=n.FatherName.replace(/Dragon/,""),kendo.format('<img class="dragon-thumb" src="{0}" /><span class="sign">{1}<\/span>',t,n.FatherName)}},{title:o.messageService.male,field:"MotherName",width:"200px",filterable:n,template:function(n){var t=o.dragonFactoryService.getImageThumbFromType(n.MotherId);return n.MotherName=n.MotherName.replace(/Dragon/,""),kendo.format('<img class="dragon-thumb" src="{0}" /><span class="sign">{1}<\/span>',t,n.MotherName)}},{title:o.messageService.breedingResult,field:"ResultName",width:"200px",filterable:n,template:function(n){var t=o.dragonFactoryService.getImageThumbFromType(n.ResultId);return n.ResultName=n.ResultName.replace(/Dragon/,""),kendo.format('<img class="dragon-thumb" src="{0}" /><span class="sign">{1}<\/span>',t,n.ResultName)}},{title:o.messageService.breedingCount,field:"Count",width:"100px",filterable:!1}]});o.grid=t.getKendoGrid()},o}return __extends(t,n),t.$inject=["$scope","$http","$element","progressBarService","dragonFactoryService","messageService"],t}(n.PageBaseController);app.controller("breedingGlobalHistoryCtrl",t)})(t=n.App||(n.App={}))})(Shared||(Shared={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Shared;(function(n){var t;(function(){var t=function(n){function t(t,i,r){var u=n.call(this,t,r)||this;return u.$scope=t,u.$http=i,u.progressBarService=r,u.$onInit=function(){u.startRequest();u.$http.post("/HistoryLog/GetLogs",null).then(function(n){_.each(n.data,function(n){var t=kendo.parseDate(n.updateAt),i=t.getFullYear()+"-"+t.getMonth()+"-"+t.getDate()+"-"+t.getHours();n.itemGroup=i});var t=_.groupBy(n.data,function(n){return n.itemGroup});u.model=t}).finally(u.finishRequest)},u}return __extends(t,n),t.$inject=["$scope","$http","progressBarService"],t}(n.PageBaseController);app.controller("taskScheduleLogCtrl",t)})(t=n.App||(n.App={}))})(Shared||(Shared={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Shared;(function(n){var t;(function(){var t=function(n){function t(t,i,r){var u=n.call(this,t,r)||this;return u.$scope=t,u.$http=i,u.progressBarService=r,u.$onInit=function(){u.startRequest();u.$http.post("/HistoryLog/GetTransferLog",null).then(function(n){var t=n.data.data;u.model=t}).finally(u.finishRequest)},u}return __extends(t,n),t.$inject=["$scope","$http","progressBarService"],t}(n.PageBaseController);app.controller("transferHistoryLogCtrl",t)})(t=n.App||(n.App={}))})(Shared||(Shared={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(n){var t;(function(){var n=Shared.PageBaseController,t=function(n){function t(t,i,r,u,f){var e=n.call(this,t,i)||this;return e.$scope=t,e.progressBarService=i,e.userInfoContext=r,e.ironManService=u,e.messageService=f,e.$onInit=function(){},e.breedingSpeedUpClick=function(){if(confirm(e.messageService.areYouSure)){e.startRequest();var n=$(window.dropDownList.BreedingResult).val();e.ironManService.breedingSpeedUp(n).then(function(t){t.success&&(e.videoAdvs=t.state.videoAds,e.userInfoContext.userConfig.breedingResult[n].TimeLeft=-1,e.ironManService.rebindBreedingResult())}).finally(function(){return e.finishRequest()})}},e.isLoading=!1,e.$scope.$on(Shared.EventName.userInfoLoaded,function(){e.videoAdvs=e.userInfoContext.userConfig.videoAdvs}),e}return __extends(t,n),t.$inject=["$scope","progressBarService","userInfoContext","ironManService","messageService"],t}(n);app.controller("breedingSectionCtrl",t)})(t=n.IronMan||(n.IronMan={}))})(App||(App={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(n){var t;(function(){var n=Shared.PageBaseController,t=function(n){function t(t,i,r,u,f){var e=n.call(this,t,i)||this;return e.$scope=t,e.progressBarService=i,e.userInfoContext=r,e.ironManService=u,e.messageService=f,e.$onInit=function(){},e.collectSpeedUpClick=function(){if(confirm(e.messageService.areYouSure)){e.startRequest();var n=$(window.dropDownList.FarmOnMap).val();e.ironManService.collectSpeedUp(n).then(function(n){n.success&&(e.videoAdvs=n.state.videoAds,window.refreshFarmOnMap(),e.refreshUserInfo(n))}).finally(function(){return e.finishRequest()})}},e.isLoading=!1,e.$scope.$on(Shared.EventName.userInfoLoaded,function(){e.videoAdvs=e.userInfoContext.userConfig.videoAdvs}),e}return __extends(t,n),t.$inject=["$scope","progressBarService","userInfoContext","ironManService","messageService"],t}(n);app.controller("farmSectionCtrl",t)})(t=n.IronMan||(n.IronMan={}))})(App||(App={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(n){var t;(function(){var n=Shared.PageBaseController,t=function(n){function t(t,i,r,u,f){var e=n.call(this,t,i)||this;return e.$scope=t,e.progressBarService=i,e.userInfoContext=r,e.ironManService=u,e.messageService=f,e.$onInit=function(){},e.collectSpeedUpClick=function(){if(confirm(e.messageService.areYouSure)){e.startRequest();var n=kendo.parseInt($(window.dropDownList.Hatchery).val());e.ironManService.hatchingSpeedUp(n).then(function(n){n.success&&(e.videoAdvs=n.state.videoAds,window.refreshEggOnHatchery())}).finally(function(){return e.finishRequest()})}},e.isLoading=!1,e.$scope.$on(Shared.EventName.userInfoLoaded,function(){e.videoAdvs=e.userInfoContext.userConfig.videoAdvs}),e}return __extends(t,n),t.$inject=["$scope","progressBarService","userInfoContext","ironManService","messageService"],t}(n);app.controller("hatcherySectionCtrl",t)})(t=n.IronMan||(n.IronMan={}))})(App||(App={}));
;
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(n){var t;(function(){var n=Shared.PageBaseController,t=function(n){function t(t,i,r,u,f,e,o,s,h){var c=n.call(this,t,f)||this;c.$scope=t;c.$location=i;c.$window=r;c.socialService=u;c.progressBarService=f;c.progressHubService=e;c.messageService=o;c.userInfoContext=s;c.ironManService=h;c.$onInit=function(){};c.listenEvent=function(){$(document).on(Shared.EventName.moveDragonToDragonarium,function(n,t){c.onMovedDragonToDragonarium(t)});c.$scope.$on(Shared.EventName.moveDragonToDragonarium,function(n,t){c.onMovedDragonToDragonarium(t)});c.$scope.$on(Shared.EventName.updateDragonarium,function(){c.model.dragonarium.slots.splice(c.mainSlide.params.slot,1);var n=(c.mainSlide.params.slot||1)-1;setTimeout(function(){c.model.dragonarium.selected=c.model.dragonarium.slots[n];c.$scope.$apply()},1e3)});c.$scope.$on(Shared.EventName.onHatcheryRefresh,function(n,t){c.model.mageShrine.eggOnHatchery=t})};c.dragonariumChange=function(n){c.model.dragonarium.selected=n};c.onMovedDragonToDragonarium=function(n){var t=_.find(c.userInfoContext.user.dragon,function(t){return t.Id===n});t&&(t=utility.toCamel(t),c.model.dragonarium.slots.push(t),c.userInfoContext.user.dragonarium.slots.push(t))};c.init=function(){var n={name:"Nothing"};c.model={dragonarium:{slots:[n],selected:n},mageShrine:{shrines:null,buildings:null}}};c.upgradeClick=function(){c.startRequest();c.progressHubService.hubStart().then(function(){c.ironManService.upgradeItem($(c.$window.dropDownList.ItemOnMap).val()).then(function(n){n.success&&(c.messageService.showMessage("Done"),c.refreshUserInfo(n))}).finally(c.finishRequest)})};c.inviteFriendClick=function(){c.isLoading=!0;c.progressBarService.set(10);c.progressHubService.hubStart().then(function(){c.socialService.inviteSocialBuilding($(c.$window.dropDownList.ItemOnMap).val()).then(function(){c.messageService.showMessage("Done")}).finally(function(){c.isLoading=!1;c.progressBarService.set(100)})});c.progressHubService.onProgressChanged=function(n){c.progressBarService.set(n)}};c.openHabitat=function(){c.mainSlide.isOpen=!0;c.mainSlide.size="80%";c.mainSlide.params={slot:c.model.dragonarium.slots.indexOf(c.model.dragonarium.selected),selectedDragon:c.model.dragonarium.selected};c.$location.path("/Habitat/Move")};c.offerPremiumClick=function(){c.mainSlide.isOpen=!0;c.mainSlide.size="50%";c.mainSlide.title=c.messageService.buyAnyItem;c.$location.path("/Buy/Item")};c.openChestClick=function(){c.isLoading=!0;c.progressBarService.start(50);var n=$(c.$window.dropDownList.ItemInStore),t=n.find("option:selected"),i=n.val(),r=t.attr("total")||0;c.socialService.openChest(i,r).then(function(i){i.success&&(c.refreshUserInfo(i),t.remove(),window.setSelectedIndex(n),utility.animation(n))}).finally(function(){c.progressBarService.set(100);c.isLoading=!1})};c.openMapClick=function(){c.mainSlide.isOpen=!0;c.mainSlide.size="90%";c.mainSlide.title="Map decoration";c.$location.path("/OpenMap")};c.castSpellClick=function(){var r=confirm(c.messageService.areYouSure);if(r){c.startRequest();var n=c.model.mageShrine.selectedBuilding,t=c.model.mageShrine.selectedEgg,i=c.model.mageShrine.breedingResult,u=c.model.mageShrine.selectedShrine.Id;c.ironManService.castSpell(u,n.Id,t&&t.Id).then(function(r){r.success&&(c.model.mageShrine.selectedShrine.TimeLeft=0,n.Name.indexOf("Breeding")>=0&&(i[n.Id]&&(i[n.Id].TimeLeft=-1),c.ironManService.rebindBreedingResult(),c.model.mageShrine.displayText="DONE"),n.Name.indexOf("Hatchery")>=0&&(t.TimeLeft=-1,c.ironManService.rebindEggOnHatchery()))}).finally(c.finishRequest)}};c.randomAllDragonsName=function(){confirm(c.messageService.areYouSure)&&(c.startRequest(),c.ironManService.randomAllDragonsName().then(function(n){n.success&&window.refreshDragonOnMap()}).finally(c.finishRequest))};c.init();$(document).on(Shared.TabName.ironMan,function(){var n=c.userInfoContext.userConfig,t=_.filter(n.itemOnIsLand,function(n){if(n.GroupType==="MAGE_SHRINE")return n.TimeLeftText=utility.parseFromSecond(n.TimeLeft),n}),i=_.filter(n.itemOnIsLand,function(n){return n.GroupType==="FARM"||n.Name.indexOf("Breeding")>-1||n.Name.indexOf("Hatchery")>-1});n.dragonarium&&n.dragonarium.slots&&(c.model={dragonarium:utility.toCamel(n.dragonarium),mageShrine:{shrines:t,buildings:i,selectedBuilding:i.length&&i[0],selectedShrine:t.length&&t[0],breedingResult:n.breedingResult,eggOnHatchery:n.itemOnHatchery}},c.model.dragonarium.selected=c.model.dragonarium.slots[0]);c.isUserInfoLoaded=!0});return c.listenEvent(),c.$scope.$watch("vm.model.mageShrine.selectedBuilding",function(n){var r=c.model.mageShrine.selectedBuilding,t,i;r&&(r.Name.indexOf("Breeding")>-1?(t=c.model.mageShrine.breedingResult[n.Id],t?(i=t.Name+" - "+(utility.parseFromSecond(t.TimeLeft)||"DONE"),t.DisplayName=i,c.model.mageShrine.displayText=i):c.model.mageShrine.displayText=null):c.model.mageShrine.displayText=null,c.model.mageShrine.selectedEgg=n.Name.indexOf("Hatchery")>-1?c.model.mageShrine.eggOnHatchery[0]:null)}),c}return __extends(t,n),t.$inject=["$scope","$location","$window","socialService","progressBarService","progressHubService","messageService","userInfoContext","ironManService"],t}(n);app.controller("tab1Ctrl",t)})(t=n.IronMan||(n.IronMan={}))})(App||(App={}));
var App;(function(n){var t;(function(){var n=function(){function n(n,t){var i=this;this.$routeParams=n;this.rescureDragonService=t;this.$onInit=function(){};this.inInt=function(){i.rescureDragonService.getItemNeedStore(i.$routeParams.dragonId).then(function(n){i.model=n})};this.storeItem=function(){};this.inInt()}return n.$inject=["$routeParams","rescureDragonService"],n}();app.controller("rescureDragonCtrl",n)})(t=n.RescureDragon||(n.RescureDragon={}))})(App||(App={}));
var App;(function(n){var t;(function(){var n,t;(function(n){n[n.Food=1]="Food";n[n.Stamina=3]="Stamina"})(n||(n={}));t=function(){function t(t,i,r,u){var f=this;this.$scope=t;this.resourceCheckerService=i;this.progressBarService=r;this.progressHubService=u;this.isLoading=!1;this.setResourceType=function(n){f.resourceType=parseInt(n)};this.$onInit=function(){};this.resourceCheckerClick=function(){f.isLoading=!0;f.resourceType===n.Food?f.checkFood():f.resourceType===n.Stamina&&f.checkStamia()};this.checkFood=function(){f.progressBarService.set(10);f.progressHubService.hubStart().then(function(){f.resourceCheckerService.check(f.model.facebookId,f.model.sessionId).then(function(n){f.model.result=n}).finally(function(){f.progressBarService.set(100);f.isLoading=!1})})};this.checkStamia=function(){f.progressBarService.start();f.resourceCheckerService.checkStamina(f.model.facebookId,f.model.sessionId).then(function(n){f.model.result=n}).finally(function(){f.progressBarService.set(100);f.isLoading=!1})};u.onProgressChanged=function(n){f.progressBarService.set(n)}}return t.$inject=["$scope","resourceCheckerService","progressBarService","progressHubService"],t}();app.controller("resourceCheckerCtrl",t)})(t=n.ResourceChecker||(n.ResourceChecker={}))})(App||(App={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n){var t=this;this.$http=n;this.check=function(n,i){return t.$http.post("/ResourceChecker/Check",{facebookId:n,sessionId:i}).then(function(n){return n.data})};this.checkStamina=function(n,i){return t.$http.post("/ResourceChecker/CheckStamina",{facebookId:n,sessionId:i}).then(function(n){return n.data})}}return n.$inject=["$http"],n}();n.ResourceCheckerService=t;app.service("resourceCheckerService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(n){var t;(function(){var n=Shared.ListPageBaseController,t=function(n){function t(t,i,r,u,f,e,o,s){var h=n.call(this,t)||this;return h.$scope=t,h.$timeout=i,h.setupAttackTeamService=r,h.dragonService=u,h.tournamentService=f,h.progressBarService=e,h.messageService=o,h.arenaService=s,h.isLoading=!0,h.isFirstLoad=!0,h.$onInit=function(){},h.getElementsName=function(n){var t=[];return _.each(n,function(n){return t.push(h.dragonAttributes[n])}),t.join(",")},h.getAvailableRarities=function(n){var t=h.rarities.indexOf(n);return _.filter(h.rarities,function(n){return h.rarities.indexOf(n)>=t})},h.init=function(){_.mixin({matchAllFirst:function(n,t){return 0===t.length?!1:t.every(function(t){return n.indexOf(t)>=0})},containsAny:function(n,t){return _.some(t,function(t){return _.contains(n,t)})}});h.rarities=["C","R","V","E","L","H"];h.dragonAttributes=window.dragonAttributes;h.setupAttackTeamService.attackTeamMode===Shared.Service.AttackTeamMode.ArenaDefense?(h.pvp=h.arenaService.pvp,h.restriction=h.setupAttackTeamService.restrictions):h.setupAttackTeamService.attackTeamMode===Shared.Service.AttackTeamMode.ArenaAttack?h.pvp=_.pluck(h.arenaService.attackTeam,"id"):(h.selectedTournament=h.tournamentService.selectedTournament,h.tournamentService.getTournament(h.tournamentService.isAllTours).then(function(n){h.setupAttackTeamService.attackTeamMode===Shared.Service.AttackTeamMode.Tournament?h.allMatches=n.allMatches:h.setupAttackTeamService.attackTeamMode===Shared.Service.AttackTeamMode.Pvp&&(h.pvp=n.pvp)}));h.loadData();h.dragonRarities=h.dragonService.getRarities();h.elements=[];h.filterModel={dragonName:"",rarity:[],elements:[]};h.$scope.$watch("vm.filterModel",function(n,t){n!==t&&h.loadData()},!0);h.setDefaultIdForSelectedDragons()},h.setDefaultIdForSelectedDragons=function(){h.selectedDragons=h.setupAttackTeamService.attackTeamMode===Shared.Service.AttackTeamMode.TrainingDragonStar?[{Id:-1}]:[{Id:-1},{Id:-2},{Id:-3}]},h.loadData=function(){h.$timeout.cancel(h.timeoutFilter);h.timeoutFilter=h.$timeout(function(){h.filterThenPaging()},500)},h.filterThenPaging=function(){h.fullDragons?h.dragonsOnMap=h.pagingItem(_.filter(h.fullDragons,function(n){return h.createFilter(n,h.filterModel)})):h.dragonService.getDragonsOnMap(!0).then(function(n){var i,t;if(h.fullDragons=n,h.dragonsOnMap=h.pagingItem(_.filter(h.fullDragons,function(n){return h.createFilter(n,h.filterModel)})),h.pvp){i=_.filter(h.fullDragons,function(n){return _.contains(h.pvp,n.Id)});for(t in h.selectedDragons)h.selectedDragons[t]=i[t]||h.selectedDragons[t]}}).finally(function(){h.isLoading=!1;h.isFirstLoad=!1})},h.onElementSelected=function(n){h.filterModel.elements=n||[]},h.rarityClick=function(n){h.filterModel.rarity=n},h.dragonClick=function(n){if(h.setupAttackTeamService.attackTeamMode===Shared.Service.AttackTeamMode.TrainingDragonStar)h.$scope.$root.$broadcast(Shared.EventName.saveDragonTrainingStar,n);else{var t=_.any(h.selectedDragons,function(t){return t.Id===n.Id});t||h.pushToSelectedDragon(n)}},h.pushToSelectedDragon=function(n,t){var i,r;t===void 0&&(t=-1);i=_.filter(h.selectedDragons,function(n){return n.Id<0});i.length&&(r=h.selectedDragons.indexOf(i[0]),h.selectedDragons[t>=0?t:r]=n)},h.selectedDragonClick=function(n){h.selectedDragons[n]={Id:(n+1)*-1}},h.fightClick=function(){h.startRequest();h.tournamentService.fight(h.selectedTournament.id,_.pluck(h.selectedDragons,"Id"),0).then(function(n){n.success&&(h.$scope.$root.$broadcast(Shared.EventName.onTournamentFight),h.refreshUserInfo(n))}).finally(h.finishRequest)},h.initDefaultFilter=function(n){n.elements=n.elements||[];n.level=n.level||0;n.rarity=n.rarity||[];n.dragonName=n.dragonName==null?"":n.dragonName;n.bannedElements=[];n.bannedRarities=[]},h.createFilter=function(n,t){return h.initDefaultFilter(t),h.restriction&&(h.restriction.allowed_rarities&&(t.rarity=t.rarity.concat(h.restriction.allowed_rarities)),h.restriction.elements&&(t.elements=t.elements.concat(h.restriction.elements)),h.restriction.banned_elements&&(t.bannedElements=h.restriction.banned_elements),h.restriction.banned_rarities&&(t.bannedRarities=h.restriction.banned_rarities)),(t.rarity.length?h.containsAny(t.rarity,[n.Rarity]):!0)&&(t.level?n.Level>=t.level:!0)&&(t.elements.length?h.arrayMatchAll(n.Elements,t.elements):!0)&&(t.dragonId?n.TypeId===t.dragonId:!0)&&(t.dragonName===""?!0:n.Name.toLowerCase().indexOf(t.dragonName)!==-1||n.CustomName.toLowerCase().indexOf(t.dragonName)!==-1)&&(t.bannedElements.length?!h.containsAny(t.bannedElements,n.Elements):!0)&&(t.bannedRarities.length?!h.containsAny(t.bannedRarities,n.Rarity):!0)},h.containsAny=function(n,t){return _.containsAny(n,t)},h.arrayMatchAll=function(n,t){return _.matchAllFirst(n,t)},h.arrayToString=function(n){return n&&n.length&&n.toString()},h.getBestDragon=function(n,t){if(t===void 0&&(t=[]),!n.length)return null;var i=n.filter(function(n){return!_.contains(t,n.Id)}),r=_.random(0,i.length-1);return i[r]},h.saveMyTeamClick=function(){h.startRequest();var n=_.pluck(h.selectedDragons,"Id");h.setupAttackTeamService.saveAttackTeam(_.pluck(h.selectedDragons,"Id")).then(function(t){t.success&&(h.$scope.$root.$broadcast(Shared.EventName.saveTeamCombat,n),h.tournamentService.tournament.pvp=n)}).finally(h.finishRequest)},h.saveMyTeamArenaClick=function(){h.startRequest();var n=_.pluck(h.selectedDragons,"Id");h.setupAttackTeamService.attackTeamMode===Shared.Service.AttackTeamMode.ArenaAttack?h.$scope.$root.$broadcast(Shared.EventName.saveArenaAttackTeam,h.selectedDragons):h.setupAttackTeamService.attackTeamMode===Shared.Service.AttackTeamMode.ArenaDefense&&h.$scope.$root.$broadcast(Shared.EventName.saveArenaDefenseTeam,n)},h.createFilerForSlot=function(n){var t=h.getRequirement(n)||{};return{rarity:t.rarity==undefined?h.dragonRarities:h.getAvailableRarities(t.rarity),level:t.level,elements:t.elements,dragonId:t.dragonId}},h.autoSelectDragonClick=function(){var t,n,i,r;h.setDefaultIdForSelectedDragons();t=h.createFilerForSlot(1);n=h.getBestDragon(_.filter(h.fullDragons,function(n){return h.createFilter(n,t)}));t=h.createFilerForSlot(2);i=h.getBestDragon(_.filter(h.fullDragons,function(n){return h.createFilter(n,t)}),[n&&n.Id]);t=h.createFilerForSlot(3);r=h.getBestDragon(_.filter(h.fullDragons,function(n){return h.createFilter(n,t)}),[i&&i.Id,n&&n.Id]);n&&h.pushToSelectedDragon(n,0);i&&h.pushToSelectedDragon(i,1);r&&h.pushToSelectedDragon(r,2);n||i||r?_.countBy(h.selectedDragons,function(n){return n.Id>0}).true<3&&h.messageService.showMessage(kendo.format(h.messageService.numberDragonMatchRequirement,_.countBy(h.selectedDragons,function(n){return n.Id>0}).true)):h.messageService.showMessage(h.messageService.noDragonMatchRequirement)},h.showMessage=function(n){clearInterval(h.timeoutMessage);h.timeoutMessage=setTimeout(function(){h.messageService.showMessage(n)},0)},h.isValid=function(){return _.filter(h.selectedDragons,function(n){return n.Id>0}).length>=3},h.filterRequirementClick=function(n){h.filterModel=h.createFilerForSlot(n);h.filterModel.level=0;h.loadData()},h.getRequirement=function(n){if(h.selectedTournament&&h.setupAttackTeamService.attackTeamMode===Shared.Service.AttackTeamMode.Tournament){var i=void 0,t=h.selectedTournament.completedStages;return t==null?i=h.selectedTournament.matches[0]:(t=t===h.selectedTournament.matches.length?t-1:t,i=h.selectedTournament.matches[t].id),h.temp=h.allMatches[i]&&h.allMatches[i]["requirements"+n]}return null},h.pageChanged=function(){h.filterThenPaging()},h.init(),h}return __extends(t,n),t.$inject=["$scope","$timeout","setupAttackTeamService","dragonFactoryService","tournamentService","progressBarService","messageService","arenaService"],t}(n);app.controller("setupAttackTeamCtrl",t)})(t=n.SetupAttackTeam||(n.SetupAttackTeam={}))})(App||(App={}));
var Shared;(function(n){var t;(function(n){var i,t;(function(n){n[n.Tournament=0]="Tournament";n[n.Pvp=1]="Pvp";n[n.ArenaDefense=2]="ArenaDefense";n[n.ArenaAttack=3]="ArenaAttack";n[n.TrainingDragonStar=4]="TrainingDragonStar"})(i=n.AttackTeamMode||(n.AttackTeamMode={}));t=function(){function n(n){var t=this;this.$http=n;this.loadAttackTeam=function(n){return t.$http.post("Home/SetAttackTeam",{tournament:n}).then(function(n){return n.data})};this.saveAttackTeam=function(n){return t.$http.post("/Home/SaveTeamCombat",{items:JSON.stringify(n)}).then(function(n){return n.data})}}return n.$inject=["$http"],n}();n.SetupAttackTeamService=t;app.service("setupAttackTeamService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n){var t=this;this.$http=n;this.checkAccount=function(n){t.$http.post("/SwapAccount/CheckAccount",n).then(function(n){return n.data})};this.linkAccount=function(n){return t.$http.post("/SwapAccount/LinkAccount",n).then(function(n){return n.data})};this.confirm=function(n){return t.$http.post("/SwapAccount/ConfirmLink",n).then(function(n){return n.data})}}return n.$inject=["$http"],n}();n.SwapAccountService=t;app.service("swapAccountService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(n){var t;(function(){var n=Shared.PageBaseController,t=function(n){function t(t,i,r,u,f){var e=n.call(this,t,r)||this;e.$scope=t;e.$location=i;e.progressBarService=r;e.tokenService=u;e.swapAccountService=f;e.$onInit=function(){};e.checkAccountClick=function(){e.token=e.model.token.toLowerCase().split("/token/")[1];e.startRequest();e.tokenService.getSessionId(e.token).then(function(n){e.model.userInfo=n;e.model.isChecked=!0}).finally(e.finishRequest)};e.linkAccountClick=function(){e.startRequest();var n=angular.copy(e.model);n.accessToken=JSON.parse(n.accessToken);n.token=e.token;e.swapAccountService.linkAccount(n).then(function(n){n&&(e.confirmModel=n,e.model.step=3)}).finally(e.finishRequest)};e.confirmClick=function(){e.startRequest();e.swapAccountService.confirm(e.confirmModel).then(function(n){e.model.step=4;e.model.lastStepError=!n}).finally(e.finishRequest)};var o=new Clipboard(".copy");return e.script="#javascript:var t=document.querySelector('[id^=\"profile_pic_header_\"').id.split('_');document.write(JSON.stringify({FacebookId:t[t.length-1], Token:window.location.hash.split('&')[0].split('access_token=')[1]}));",e}return __extends(t,n),t.$inject=["$scope","$routeParams","progressBarService","tokenService","swapAccountService"],t}(n);app.controller("swapAccountCtrl",t)})(t=n.TokenSession||(n.TokenSession={}))})(App||(App={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(n){var t;(function(){var n=Shared.PageBaseController,t=function(n){function t(t,i,r,u){var f=n.call(this,t,r)||this,h,e,o,s;return f.$scope=t,f.$location=i,f.progressBarService=r,f.tokenService=u,f.isLoading=!1,f.errorMessage="",f.successMessage="",f.$onInit=function(){},f.init=function(n){f.mode=n;f.model={}},f.generateTokenClick=function(){f.successMessage=f.errorMessage="";f.progressBarService.start();f.isLoading=!0;f.tokenService.generateToken(f.model).then(function(n){n.success?window.location.href="/Token/"+n.result.personalToken:(f.errorMessage=n.message,f.isLoading=!1)}).finally(function(){f.progressBarService.set(100)})},f.forgotTokenClick=function(){f.startRequest();f.successMessage=f.errorMessage="";f.tokenService.sendTokenToEmail(f.model.email).then(function(n){n.success?f.successMessage=n.message:f.errorMessage=n.message}).finally(f.finishRequest)},f.deleteTokenClick=function(){window.confirm("Are you sure ?")&&(f.startRequest(),f.tokenService.deleteToken(f.model.tokenDelete).then(function(n){n.success?f.successMessage=n.message:f.errorMessage=n.message}).finally(f.finishRequest))},f.openTokenLinkClick=function(){},f.isValid=function(){return/^\d+$/.test(f.model.facebookId)},f.createTokenLinkClick=function(){f.isLoading=!0;f.progressBarService.start();f.accessToken&&f.tokenService.createTokenLinkFromFbAccess(f.gameType,f.accessToken,f.model.email).then(function(n){n.success?window.location.href="/Token/"+n.result.personalToken:alert(n.message)}).catch(function(){alert("There are some errors. Please try again")}).finally(function(){f.progressBarService.complete();f.isLoading=!1})},h=new Clipboard(".copy"),e='document.getElementsByName("signed_request")[0].value',f.script="#javascript:document.write("+e+");",o="var t=document.querySelector('[id^=\"profile_pic_header_\"').id.split('_')",s="window.location.hash.split('&')[0].split('access_token=')[1]",f.scriptForMl="#javascript:"+o+";document.write(JSON.stringify({FacebookId:t[t.length-1], Token:"+s+"}));",f}return __extends(t,n),t.$inject=["$scope","$routeParams","progressBarService","tokenService"],t}(n);app.controller("registerTokenCtrl",t)})(t=n.TokenSession||(n.TokenSession={}))})(App||(App={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(n){var t;(function(){var n=function(n){function t(t,i,r,u){var f=n.call(this,t,r)||this;return f.$scope=t,f.$timeout=i,f.progressBarService=r,f.tokenService=u,f.isLoading=!1,f.$onInit=function(){f.retry=3;f.count=0;f.totalSeconds=4},f.init=function(n){f.model={token:n};f.isLoading=!0;f.checkLinkedToDevice()},f.checkLinkedToDevice=function(){f.tokenService.isLinkedToDevice(f.model.token).then(function(n){f.model.isLinkedToDevice=n;n?(window.clearTimeout(f.timeout),f.getSessionId()):f.timeout=setTimeout(f.checkLinkedToDevice,100)}).finally(function(){f.isLoading=!1})},f.getSessionId=function(){f.startRequest();f.gettingSession=!0;f.tokenService.getSessionId(f.model.token).then(function(n){if(f.model.isLinkedToDevice=!0,n.success===!1){f.model.errorMessage=n.message;return}f.model.facebookId=n.facebookId;f.model.sessionId=n.sessionId;document.title=n.name+" - "+document.title;f.model.accountName=n.name;f.model.sessionId||(f.model.tryAgain=!0)}).finally(function(){f.finishRequest();f.gettingSession=!1})},f.onCountDownReached=function(){f.count>=f.retry||f.model.tryAgain&&(f.count++,f.model.tryAgain=!1,f.getSessionId())},f}return __extends(t,n),t.$inject=["$scope","$timeout","progressBarService","tokenService"],t}(Shared.PageBaseController);app.controller("sessionTokenCtrl",n)})(t=n.TokenSession||(n.TokenSession={}))})(App||(App={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n){var t=this;this.$http=n;this.generateToken=function(n){return t.$http.post("/TokenSession/GenerateToken",n).then(function(n){return n.data})};this.isLinkedToDevice=function(n){return t.$http.post("/TokenSession/LinkedToDevice",{token:n}).then(function(n){return n.data})};this.getSessionId=function(n){return t.$http.post("/TokenSession/GetSession",{token:n}).then(function(n){return n.data})};this.sendTokenToEmail=function(n){return t.$http.post("/TokenSession/SendTokenToEmail",{email:n}).then(function(n){return n.data})};this.deleteToken=function(n){return t.$http.post("/TokenSession/DeleteToken",{token:n}).then(function(n){return n.data})};this.createTokenLinkFromFbAccess=function(n,i,r){return t.$http.post("/TokenSession/CreateTokenLinkFromFbAccess",{gameType:n,accessToken:i,email:r}).then(function(n){return n.data})}}return n.$inject=["$http"],n}();n.TokenService=t;app.service("tokenService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(n){var t;(function(n){var t;(function(){var i=Shared.PageBaseController,n,t;(function(n){n[n.Fight=0]="Fight";n[n.MyArena=1]="MyArena";n[n.Top=2]="Top"})(n||(n={}));t=function(t){function i(i,r,u,f,e,o,s){var h=t.call(this,i,e)||this;h.$scope=i;h.$location=r;h.arenaService=u;h.setupAttackTeamService=f;h.progressBarService=e;h.messageService=o;h.dragonFactoryService=s;h.isLoading=!1;h.arenaLoaded=!1;h.totalKillAllow=10;h.$onInit=function(){};h.fight=function(n,t){h.startRequest();var i=_.pluck(h.arenaService.attackTeam,"id"),r=t?h.arenaService.fightWithPremium(n||h.model.next_opponent.user_id,i,h.totalKillAllow):h.arenaService.fight(n||h.model.next_opponent.user_id,i);r.then(function(n){var r,u;n.success&&(r=n.result,h.model.next_opponent=r.next_opponent,h.model.rank=r.rank,h.model.trophies=r.trophies,h.model.arena_id=n.result.next_opponent.arena_id,h.bindDataFromResponse(n),i&&i.length&&(u=h.dragonFactoryService.updateDragonKill(i,h.model.totalWin||1),_.each(h.attackTeam,function(n){return n.kill+=u[n.id]})),t&&(h.attackCountLeft-=h.totalKillAllow,h.$scope.$root.$broadcast(Shared.EventName.refreshAttackCount,h.attackCountLeft)))}).finally(h.finishRequest)};h.fightClick=function(n){h.fight(n,!1)};h.fightWithPremiumClick=function(n){h.fight(n,!0)};h.refillClick=function(){var n=window.confirm(h.messageService.areYouSure);n&&(h.startRequest(),h.arenaService.refill().then(function(n){n.success&&(h.model.stamina=n.state.pvpArenas.stamina,h.refreshUserInfo(n))}).finally(h.finishRequest))};h.skipEnemyClick=function(){var n=window.confirm(h.messageService.areYouSure);n&&(h.startRequest(),h.arenaService.skipEnemy(h.model.next_opponent.user_id).then(function(n){n.success&&(h.model.next_opponent=n.result.next_opponent,h.bindDataFromResponse(n))}).finally(h.finishRequest))};h.getInfo=function(){h.isLoading=!0;h.arenaService.getInfo().then(function(n){h.$scope.$root.$broadcast(Shared.EventName.arenaLoaded,n);h.arenaLoaded=!0;h.isLoading=!1;n.userData&&(h.model=n.userData,h.attackCountLeft=n.attackCountLeft,h.attackCountLeftInSeconds=n.attackCountLeftInSeconds,h.attackCountAllow=n.attackCountAllow,h.totalKillAllow=n.totalKillAllow,h.currentRestrictions=_.find(n.config.arenas,function(t){return t.id===n.userData.arena_id}).restrictions,h.model.skipCost=h.buildSkipCostModel(),h.arenaService.pvp=n.userData.team,h.attackTeam=h.arenaService.attackTeam=n.attackTeam,h.addKillMessage=kendo.format(h.messageService.addKill,Math.min(h.attackCountLeft,h.totalKillAllow)),h.bindImageUrlFoDragon(h.model.next_opponent.team),h.bindImageUrlFoDragon(h.attackTeam),h.bindRestrictElement(n))}).then(function(){h.refreshArenaStatus()})};h.bindDataFromResponse=function(n){h.model.stamina=n.state.pvpArenas.stamina;h.model.skipCost=h.buildSkipCostModel();h.bindImageUrlFoDragon(h.model.next_opponent.team);h.refreshUserInfo(n)};h.bindRestrictElement=function(n){var r=n.userData.arena_id,i=_.filter(n.config.arenas,function(n){return n.id===r})[0],t;i&&(t=i.restrictions,t.banned=_.union(t.banned_elements,t.banned_rarities),h.model.arena=i)};h.getImageFromElementName=function(n){return h.dragonFactoryService.getImageFromElementName(n)};h.buildSkipCostModel=function(){return h.model.next_opponent.skip_cost.g?{name:"Gold",value:h.model.next_opponent.skip_cost.g}:h.model.next_opponent.skip_cost.f?{name:"Food",value:h.model.next_opponent.skip_cost.f}:h.model.next_opponent.skip_cost.c?{name:"Gems",value:h.model.next_opponent.skip_cost.c}:void 0};h.bindImageUrlFoDragon=function(n){_.each(n,function(n){var t=window.itemImage[n.type||n.typeId];n.imageUrl=h.dragonFactoryService.imgUrl+t+"_3.png";n.thumbUrl=h.dragonFactoryService.imgUrl+t.replace(/ui/g,"HD/thumb")+"_3.png"})};h.setAttackTeamArenaClick=function(){h.setupAttackTeamService.attackTeamMode=Shared.Service.AttackTeamMode.ArenaAttack;h.mainSlide.isOpen=!0;h.mainSlide.size="80%";h.mainSlide.title=h.messageService.setAttackTeam;h.$location.path("/SetAttackTeam/ArenaAttack")};h.setDefenseTeamArenaClick=function(){h.setupAttackTeamService.attackTeamMode=Shared.Service.AttackTeamMode.ArenaDefense;h.setupAttackTeamService.restrictions=h.currentRestrictions;h.mainSlide.isOpen=!0;h.mainSlide.size="80%";h.mainSlide.title=h.messageService.setDefenseTeam;h.$location.path("/SetAttackTeam/ArenaDefense")};h.onSaveAttackTeamCompleted=function(n){n=utility.toCamel(n);var t=_.filter(n,function(n){return n.id>0}),i=_.pluck(t,"id");h.arenaService.saveAttackTeamCombat(i).then(function(n){n.success&&(h.attackTeam=h.arenaService.attackTeam=t,h.mainSlide.isOpen=!1)}).finally(h.finishRequest)};h.onSaveDefenseTeamCompleted=function(n){h.arenaService.saveTeamCombat(n).then(function(t){t.success&&(h.arenaService.pvp=n,h.mainSlide.isOpen=!1)}).finally(h.finishRequest)};h.updateDragonStar=function(n,t){h.dragonFactoryService.updateDragonKill(n,t)};h.changeTabClick=function(n){h.selectedTab=n;h.loadLeaderBoard()};h.loadLeaderBoard=function(){h.leaderBoards||(h.startRequest(),h.arenaService.leaderBoards(h.model.arena_id).then(function(n){h.leaderBoards=JSON.parse(n)}).finally(h.finishRequest))};h.refreshArenaStatus=function(){};h.acceptAttackClick=function(){h.startRequest();h.arenaService.acceptAttack().then(function(n){n.success&&(h.model.offline_attacks.amount=0)}).finally(h.finishRequest)};h.repealClick=function(){h.startRequest();h.arenaService.repeal().then(function(n){n.success&&(h.model.offline_attacks.amount=0)}).finally(h.finishRequest)};h.openWarriorChestClick=function(){h.startRequest();h.arenaService.openWarriorChest().then(function(n){n.success&&(h.model.warrior_chest.current_points=0)}).finally(h.finishRequest)};h.selectedTab=n.Fight;$(document).on(Shared.TabName.superMan,function(){h.getInfo();h.selectedTab!==n.Fight&&(h.leaderBoards=null,h.loadLeaderBoard())});return i.$on(Shared.EventName.saveArenaAttackTeam,function(n,t){h.onSaveAttackTeamCompleted(t)}),i.$on(Shared.EventName.saveArenaDefenseTeam,function(n,t){h.onSaveDefenseTeamCompleted(t)}),h}return __extends(i,t),i.$inject=["$scope","$location","arenaService","setupAttackTeamService","progressBarService","messageService","dragonFactoryService"],i}(i);app.controller("arenaCtrl",t)})(t=n.Arena||(n.Arena={}))})(t=n.Tournament||(n.Tournament={}))})(App||(App={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n){var t=this;this.$http=n;this.fight=function(n,i){return t.$http.post("/Arena/Fight",{userId:n,dragonIds:i}).then(function(n){return n.data})};this.fightWithPremium=function(n,i,r){return t.$http.post("/Arena/FightWithPremium",{userId:n,dragonIds:i,totalKill:r}).then(function(n){return n.data})};this.getInfo=function(){return t.$http.post("/Arena/Info",null).then(function(n){return n.data})};this.refill=function(){return t.$http.post("/Arena/Refill",null).then(function(n){return n.data})};this.saveTeamCombat=function(n){return t.$http.post("/Arena/SaveTeamCombat",n).then(function(n){return n.data})};this.saveAttackTeamCombat=function(n){return t.$http.post("/Arena/SaveAttackTeamCombat",{dragonIds:n}).then(function(n){return n.data})};this.skipEnemy=function(n){return t.$http.post("/Arena/SkipEnemy",{userId:n}).then(function(n){return n.data})};this.leaderBoards=function(n){return t.$http.post("/Arena/LeaderBoards",{arenaId:n}).then(function(n){return n.data})};this.refreshArenaStatus=function(){return t.$http.post("/Arena/RefreshStatus",null).then(function(n){return n.data})};this.repeal=function(){return t.$http.post("/Arena/Repeal",null).then(function(n){return n.data})};this.acceptAttack=function(){return t.$http.post("/Arena/AcceptAttack",null).then(function(n){return n.data})};this.openWarriorChest=function(){return t.$http.post("/Arena/OpenWarriorChest",null).then(function(n){return n.data})}}return n.$inject=["$http"],n}();n.ArenaService=t;app.service("arenaService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(n){var t;(function(n){var t;(function(){var n=Shared.PageBaseController,t=function(n){function t(t,i,r,u,f,e,o){var s=n.call(this,t,u)||this;return s.$scope=t,s.$location=i,s.combatLeagueService=r,s.progressBarService=u,s.setupAttackTeamService=f,s.messageService=e,s.dragonFactoryService=o,s.isLoading=!1,s.countDownForNextKill=0,s.startCountDownForNextKill=0,s.$onInit=function(){},s.countDownTrainingStar=0,s.loadFriends=function(){s.startRequest();s.combatLeagueService.loadFriends(s.model.signedRequest).then(function(n){s.model.friends=n}).finally(s.finishRequest)},s.fight=function(n){s.startRequest();s.combatLeagueService.fight(n).then(s.refreshUserInfo).finally(s.finishRequest)},s.trainingStar=function(){s.startRequest();s.combatLeagueService.trainingStar(utility.toCamel(s.selectedDragon).id).then(function(n){n.success?(s.model.attackCountLeft-=n.result.kill-s.selectedDragon.kill,s.model.attackCountLeft<0&&(s.model.attackCountLeft=0),s.selectedDragon.kill=n.result.kill,s.countDownForNextKill=60,s.startCountDownForNextKill=1,s.refreshUserInfo(n),s.dragonFactoryService.updateDragonKillLocal(s.selectedDragon.id,s.selectedDragon.kill)):s.countDownTrainingStar=parseInt(n.result)}).finally(s.finishRequest)},s.selectDragonTrainingStartClick=function(){s.mainSlide.isOpen=!0;s.mainSlide.size="80%";s.setupAttackTeamService.attackTeamMode=Shared.Service.AttackTeamMode.TrainingDragonStar;s.$location.path("/SetAttackTeam/TrainingDragonStar")},s.$scope.$on(Shared.EventName.saveDragonTrainingStar,function(n,t){s.mainSlide.isOpen=!1;s.selectedDragon=utility.toCamel(t)}),s.$scope.$on(Shared.EventName.arenaLoaded,function(n,t){s.model=t;s.addKillMessage=kendo.format(s.messageService.addKill,Math.min(s.model.attackCountLeft,s.model.totalKillAllow))}),s.$scope.$on(Shared.EventName.refreshAttackCount,function(n,t){s.model.attackCountLeft=t}),s}return __extends(t,n),t.$inject=["$scope","$location","combatLeagueService","progressBarService","setupAttackTeamService","messageService","dragonFactoryService"],t}(n);app.controller("combatLeagueCtrl",t)})(t=n.CombatLeague||(n.CombatLeague={}))})(t=n.Tournament||(n.Tournament={}))})(App||(App={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n){var t=this;this.$http=n;this.loadFriends=function(n){return t.$http.post("/Arena/GetFriends",{signedRequest:n}).then(function(n){return n.data})};this.fight=function(n){return t.$http.post("/Arena/CombatLeagueFight",{facebookId:n}).then(function(n){return n.data})};this.trainingStar=function(n){return t.$http.post("/Arena/TrainingDragonStar",{dragonId:n}).then(function(n){return n.data})}}return n.$inject=["$http"],n}();n.CombatLeagueService=t;app.service("combatLeagueService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(n){var t;(function(){var i=Shared.PageBaseController,n,t;(function(n){n[n.All=0]="All";n[n.Current=1]="Current"})(n||(n={}));t=function(t){function i(i,r,u,f,e,o,s){var h=t.call(this,i,f)||this;h.$scope=i;h.$location=r;h.tournamentService=u;h.progressBarService=f;h.setupAttackTeamService=e;h.messageService=o;h.dragonFactorySevice=s;h.isLoadedPopup=!1;h.$onInit=function(){};h.shouldGetAllTours=!1;h.timeLeft=function(n){var t=n-Date.parse((new Date).toString())/1e3;if(t<0)return"00:00:00";var u=t%60,i=Math.floor(t/60),r=Math.floor(i/60);return i%=60,r%=60,h.format(r)+":"+h.format(i)+":"+h.format(u)};h.loadAllTournamentClick=function(){h.shouldGetAllTours=!0;h.tournamentService.tournament=null;h.loadTournament()};h.loadTournament=function(){h.startRequest();h.tournamentService.getTournament(h.shouldGetAllTours).then(function(n){_.each(n.userTournaments,function(n){n.timeLeft=h.timeLeft(n.nextMatch)});h.userTournaments=n.userTournaments;h.allTournaments=n.allTournaments;h.allMatches=n.allMatches;h.pvp=n.pvp;h.selectedTournament=h.userTournaments[0];h.selectedAllTournament=h.allTournaments[0]}).finally(h.finishRequest)};h.resetCountDown=function(){h.isStart=0};h.getTotalSeconds=function(){var n=h.selectedTournament?(h.selectedTournament.nextMatch-Date.parse((new Date).toString()))/60:0;return parseInt(n.toString())};h.tournamentClick=function(){h.mode=n.Current;h.setupAttackTeamService.attackTeamMode=Shared.Service.AttackTeamMode.Tournament;h.tournamentService.selectedTournament=h.selectedMainTournament=h.selectedTournament;h.mainSlide.isOpen=!0;h.mainSlide.size="80%";h.mainSlide.title="Set Tournament attack team";h.$location.path("/SetAttackTeam/Tournament")};h.joinAndFightClick=function(){h.mode=n.All;h.setupAttackTeamService.attackTeamMode=Shared.Service.AttackTeamMode.Tournament;h.tournamentService.selectedTournament=h.selectedMainTournament=h.selectedAllTournament;h.mainSlide.isOpen=!0;h.mainSlide.size="80%";h.mainSlide.title="Set Tournament attack team";h.$location.path("/SetAttackTeam/Tournament")};h.viewAllTournamentsClick=function(){h.mainSlide.isOpen=!0;h.mainSlide.size="40%";h.mainSlide.title=h.messageService.allTournamentsCup;h.$location.path("/Tournament/ViewAllTournaments")};h.fillUpCombatCountClick=function(){confirm(h.messageService.areYouSure)&&(h.startRequest(),h.tournamentService.fillUpCombatCount().then(function(n){n.success&&h.refreshUserInfo(n)}).finally(h.finishRequest))};h.setAttackTeamClick=function(){var n={text:"Save",click:function(){},cssClass:"btn btn-default"},t={text:"fight",click:function(){},cssClass:"btn btn-default"};h.setupAttackTeamService.attackTeamMode=Shared.Service.AttackTeamMode.Pvp;h.tournamentService.selectedTournament=null;h.mainSlide.isOpen=!0;h.mainSlide.size="80%";h.mainSlide.title="Set Pvp attack team";h.$location.path("/SetAttackTeam/Pvp")};h.format=function(n){return kendo.toString(n,"00")};h.onFightCompleted=function(){h.mode===n.All?(h.allTournaments=_.filter(h.allTournaments,function(n){return n.id!==h.selectedAllTournament.id}),h.userTournaments.push(h.selectedMainTournament),h.selectedMainTournament.isWon=!0):(h.selectedTournament.completedStages++,h.selectedMainTournament.isWon=!0)};h.getRequirement=function(n){if(h.selectedTournament){var i=void 0,t=h.selectedTournament.completedStages;return t==null?i=h.selectedTournament.matches[0]:(t=t===h.selectedTournament.matches.length?t-1:t,i=h.selectedTournament.matches[t].id),h.allMatches[i]&&h.allMatches[i]["requirements"+n]}return null};$(document).on(Shared.TabName.superMan,function(){h.loadTournament();h.dragonFactorySevice.dragonsOnMap=null});return h.$scope.$on(Shared.EventName.onTournamentFight,function(){h.mainSlide.isOpen=!1;h.onFightCompleted()}),h.$scope.$on(Shared.EventName.saveTeamCombat,function(n,t){h.mainSlide.isOpen=!1;t&&(h.pvp=t)}),h}return __extends(i,t),i.$inject=["$scope","$location","tournamentService","progressBarService","setupAttackTeamService","messageService","dragonFactoryService"],i}(i);app.controller("tournamentCtrl",t)})(t=n.Tournament||(n.Tournament={}))})(App||(App={}));
var Shared;(function(n){var t;(function(n){var t=function(){function n(n,t){var i=this;this.$http=n;this.$q=t;this.getTournament=function(n){i.isAllTours=n;var t=i.$q.defer();return i.tournament?t.resolve(i.tournament):i.$http.post("/Tournament/Get",{isAll:n}).then(function(n){i.tournament=n.data;t.resolve(i.tournament)}),t.promise};this.fight=function(n,t,r){return i.$http.post("/Tournament/Fight",{tournamentId:n,dragons:t,definedId:r}).then(function(n){return n.data})};this.fixCombatError=function(){return i.$http.post("/Tournament/FixCombatError",null).then(function(n){return n.data})};this.viewAllTournamanets=function(){var n=i.$q.defer();return i.viewAllTournament&&n.resolve(i.viewAllTournament),i.$http.post("/Tournament/GetAllTournaments",null).then(function(t){i.viewAllTournament=t.data;n.resolve(i.viewAllTournament)}),n.promise};this.fillUpCombatCount=function(){return i.$http.post("/Tournament/fillUpCombatCount",null).then(function(n){return n.data})}}return n.$inject=["$http","$q"],n}();n.TournamentService=t;app.service("tournamentService",t)})(t=n.Service||(n.Service={}))})(Shared||(Shared={}));
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),App;(function(n){var t;(function(){var n=function(n){function t(t,i,r,u){var f=n.call(this,t,r)||this;return f.$scope=t,f.tournamentService=i,f.progressBarService=r,f.dragonFactoryService=u,f.$onInit=function(){},f.startRequest(),f.tournamentService.viewAllTournamanets().then(function(n){_.each(n,function(n){n.egg&&(n.imageUrl=f.dragonFactoryService.getImageFromType(n.egg))});f.model=n}).finally(f.finishRequest),f}return __extends(t,n),t.$inject=["$scope","tournamentService","progressBarService","dragonFactoryService"],t}(Shared.PageBaseController);app.controller("viewAllTournamentsCtrl",n)})(t=n.Tournament||(n.Tournament={}))})(App||(App={}));
var App;(function(){var n=function(){function n(n,t){var i=this;this.$scope=n;this.messageService=t;this.$onInit=function(){i.model=[{Link:"https://youtu.be/HoCqXjesLKk",Title:"How to find facebookId and SessionId"},{Link:"https://youtu.be/h30RItZgnVI",Title:"How to create token link for mobile device"},{Link:"https://youtu.be/wXYNpKsMpds",Title:"How to open Dragon Market without invite friends"},{Link:"https://youtu.be/XxZ9M_4U2Nk",Title:"How to get some Dragons free in Recuriment Tarven without invite friends"},{Link:"https://youtu.be/uhIpAImLY0U",Title:"How to training Dragon Stars (Premium Account)"},{Link:"https://youtu.be/JYn1h6pmEok",Title:"How to training multiple dragons same time (Premium Account)"}]};this.$onInit()}return n.$inject=["$scope","messageService"],n}();app.controller("tutorialCtrl",n)})(App||(App={}));
